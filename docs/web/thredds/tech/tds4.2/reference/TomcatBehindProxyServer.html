<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><title>Running Tomcat Behind a Proxy Server</title></head>
<body>
<h1><img src="../../images/unidataLogo.png" width="75" height="75" align="middle">Running Tomcat Behind a Proxy Server</h1>
<hr>
<h2>Tomcat and Apache mod_proxy<br>
</h2>
<p>[Thanks to Michael Godin (MBARI) and Greg Keith and Ernie Joynt (NOAA) for the following documentation.]<br>
</p>
<p>If you are using Tomcat on port 8080 (for example) and Apache on the
default port 80, you can use the Apache proxy module to hide the Tomcat
port in the URLs used to connect to THREDDS.&nbsp; This may be critical
if your server is behind a firewall that only allows port 80
access.&nbsp; It is also important if THREDDS is running on a machine
that is completely behind a firewall, but you have a server running
Apache that can talk to the machine.</p>
<p>You will need to edit the Apache httpd.conf file (on Linux, it is stored in /etc/httpd/conf/).</p>
<p>Find the lines that start with "&lt;IfModule mod_proxy.c&gt;" and
end with "&lt;/IfModule&gt;".&nbsp; These lines may need to be
uncommented.&nbsp; Between these lines, make sure the following line
exists and is uncommented:</p>
<pre>    ProxyRequests On<br></pre>
<p>Then add the following lines:</p>
<pre>    ProxyPreserveHost On<br>    &lt;Location /thredds&gt;<br>        ProxyPass <a class="moz-txt-link-freetext" href="http://myhost.mydomain:8080/thredds">http://myhost.mydomain:8080/thredds</a><br>        ProxyPassReverse <a class="moz-txt-link-freetext" href="http://myhost.mydomain:8080/thredds">http://myhost.mydomain:8080/thredds</a><br>    &lt;/Location&gt;<br>    &lt;Proxy <a class="moz-txt-link-freetext" href="http://myhost.mydomain:8080/thredds">http://myhost.mydomain:8080/thredds</a>&gt;<br>        AllowOverride None<br>        Order allow,deny<br>        Allow from All<br>    &lt;/Proxy&gt;<br></pre>
<p>You of course need to replace "http://myhost.mydomain:8080/thredds" with the full URL of the THREDDS web application.</p>
<p>The section between &lt;Proxy... And &lt;/Proxy&gt; can usually be
omitted, but in some cases a server is sufficiently locked down that
you need to explicitly allow access to resources.&nbsp; It can also be
edited to restrict access to registered users via Apache authentication
mechanisms.</p>
<p>You can also add additional proxy directives to mask the THREDDS URL  and port in any TDS-generated file access pages. The above ProxyPass  and ProxyPassReverse directives mask the machine name and port using  mod_proxy during an initial THREDDS URL request, but leave this  information visible on the data access page generated by TDS.    </p>
<p>If you add the following directives BEFORE the directives above,  Apache will use mod_proxy_ajp in addition to the mod_proxy directives,  so that any TDS-generated access pages will use the same URL as shown  in the initial THREDDS request (example shown for Apache 2.2):    </p>
<pre>  LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
  ProxyPass /thredds         ajp://localhost:8009/thredds
  ProxyPassReverse /thredds  ajp://localhost:8009/thredds    </pre>
<p>This also requires uncommenting the AJP connector (port 8009) in the  Tomcat server.xml file.</p>
<p>Finally, on the server command line (as a super/admin user), execute:</p>
<pre>    apachectl graceful<br></pre>
<p>In my configuration, I initially failed to add the line
"ProxyPreserveHost On", which caused me many headaches as links
generated by THREDDS kept directing the client back to port 8080 (which
was blocked by a firewall).<br>
</p>
<h3>Tomcat Documentation<br>
</h3>
<ul>
  <li><a href="http://tomcat.apache.org/tomcat-6.0-doc/proxy-howto.html">Tomcat 6.0 Proxy Support HOW-TO</a></li>
  <li><a href="http://tomcat.apache.org/tomcat-5.5-doc/proxy-howto.html">Tomcat 5.5 Proxy Support HOW-TO</a></li>
  <li><a href="http://tomcat.apache.org/connectors-doc/">Tomcat Connectors</a></li>
</ul>
<h2>Tomcat and Apache mod_jk</h2>
<p>Sounds like mod_jk is more powerful than mod_proxy. If anyone has
experience using mod_jk and could contribute some text here, please let
us know at <a href="mailto:thredds@unidata.ucar.edu">thredds@unidata.ucar.edu</a>.</p>
<p><a href="http://oreilly.com/catalog/9780596101060/chapter/ch04.pdf">Tomcat Tuning</a> free online chapter in <a href="http://oreilly.com/catalog/9780596101060/index.html">Tomcat: The Definitive Guide</a> (2007) has some timing comparisions between Tomcat and Apache http. You might be surprised at the results.<br>
</p>
<h3>Tomcat Documentation</h3>
<ul>
  <li><a href="http://tomcat.apache.org/connectors-doc/webserver_howto/apache.html">Apache Tomcat Connector - Webserver HowTo</a></li>
</ul>
<pre></pre>
<hr width="100%">
<address>
<img src="../../images/thread.png" height="108" width="110">This document is maintained by Unidata and was last updated on Dec 23, 2008.
</address>
<address>
</address>
<address>
</address>
<address>
</address>
<address>
</address>
<address>
Send comments to <a href="mailto:thredds@unidata.ucar.edu">thredds@unidata.ucar.edu</a> or <a href="mailto:support-thredds@unidata.ucar.edu">support-thredds@unidata.ucar.edu</a>.<br>
 
</address>
<p>&nbsp; </p>
</body></html>