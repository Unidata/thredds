<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
 <html>
  <head>
   <title>TDS Tutorial: Tomcat and TDS Security</title>
   <link rel="stylesheet" href="tutorial.css" type="text/css" /> 
   <script language="JavaScript1.2" src="http://www.unidata.ucar.edu/acemenu/last_mod.js"></script>
   <link rel="SHORTCUT ICON" href="http://www.unidata.ucar.edu/favicon.ico" type="image/x-icon" />
  </head>
  <body>


   <h1>TDS Tutorial: Tomcat and TDS Security</h1>

   <h4 class="synopsis">Best practices and recommendations on securing a production TDS/Tomcat server.</h4>


   <div id="section">
    <h2><a name="why">Why Is This Important?</a> </h2>
     <div id="subsection">
      <h3>Be afraid</h3>
      <ul>
       <li>Misconfiguration of Tomcat can introduce vulnerabilities in security.</li>
       <li>The following recommendations should be considered "layers" of security: not completely effective by themselves, but more potent when combined.</li>
       <li><i>This is not a complete laundry list of security fixes!</i> Please use it as a starting point when securing your server.</li>
       <li>Suggestions below listed in random order (section ordering is not a representation of the section importance).</li>
      </ul>

     </div> <!-- end Be afraid subsection -->

   </div> <!-- end Why Is This Important? section -->


   <div id="section">
    <h2><a name="versions">Keeping Software Versions Up-To-Date</a> </h2>
     
     <div id="subsection">
     <h3>Rationale</h3>

      <ul>
      <li>Running the most current versions of software keeps your environment protected against <i>known</i> <a href="http://www.securityfocus.com/vulnerabilities">security vulnerabilities</a>.  This includes the JDK, Tomcat, the TDS and any other third-party libraries or software you run.</li>
      <li>Stay Informed!  Subscribe to announcement lists for Tomcat, the TDS and any other software you deploy, to stay abreast of new versions released due to security issues.</li>
      <li>As soon as a security issue is disclosed, potential attackers will begin trying to exploit that vulnerability. It is important that you upgrade your software before an attacker uses the vulnerability against you.</li>
      </ul>
     </div> <!-- end Rationale subsection -->

     <div id="subsection">
      <h3>Resources</h3>
      <ul>
       <li><a href="http://tomcat.apache.org/security.html">Tomcat security reports</a><br>      A complete list of known and documented security vulnerabilities associated with each Tomcat release.</li>
       <li><a href="http://tomcat.apache.org/lists.html"><code>tomcat-users</code> mailing list</a><br>     A high-traffic mailing list made up of Tomcat users.  New releases of Tomcat are likely to be announced here.</li>
       <li><a href="http://java.sun.com/javase/technologies/security/">Java SE Security</a><br>     Sun's Java security page which includes a chronology of Java security issues and user forums.</li>
       <li><a href="/mailing_lists/archives/thredds/"><code>thredds</code> mailing list</a><br>     The THREDDS mailing list where announcements of new releases will be made.</li>
       <li><a href="http://www.securityfocus.com/vulnerabilities">Buqtraq vunerability database</a><br>     SecurityFocus' database of all known vulnerabilities for all different types of software from different vendors.</li>
      </ul>

     </div> <!-- end Resources subsection -->

   </div> <!-- end Keeping Software Versions Up-To-Date section -->


   <div id="section">
    <h2><a name="install">Tomcat Process User/Group and $CATALINA_HOME Permissions</a> </h2>
     <div id="subsection">
     <h3>Rationale</h3>
      <div id="note" class="info">
       <h4>Background info</h4>
       <p>The JVM doesn't fork at all, nor does it support <code>setuid()</code> calls. The JVM (and therefore Tomcat) is one process. The JVM is a virtual machine with many threads under the same process. </p>
      </div>
      <ul>
       <li>Because of OS constraints, all threads in the same JVM process must run under the same user id.  No thread may run as the <code>root</code> user unless they are all are run as the <code><small>root</small></code> user. Hence, any programs run in Tomcat (TDS, <code>manager</code> application, other JSPs and servlets) will run as the <code>root</code> user.</li>
       <li>If you choose to run the Tomcat process as the <code>root</code> user, and an attacker manages to exploit a weakness in Tomcat or something running in <code>webapps/</code> to run arbitrary commands,  <i>those commands will be run as the superuser</i>!</li>
       <li>We <i>strongly discourage</i> running Tomcat as the <code>root</code> user and recommend creating an unprivileged, dedicated user and group for running the Tomcat process.</li>
       <li>We also recommend restricting the permissions of the Tomcat user/group within <code>$CATALINA_HOME</code>.</li>
      </ul>
     </div> <!-- end Rationale subsection -->


     <div id="subsection">
      <h3>Creating a dedicated Tomcat user/group &amp; setting permissions in <code>$CATALINA_HOME</code></h3>
      <ol>
       <li>Create a dedicated user and group for running Tomcat.</li>
       <p>In this example, both the user and group names will be names <code><small>tomcat</small></code>, and the user's home directory, aka <code><small>$CATALINA_HOME</small></code>,  is <code><small>/opt/tomcat</small></code> (notice the symlink below).  The groupadd and useradd commands were run as the root:</p>
<pre>
<b>#</b> groupadd tomcat
<b>#</b> useradd -g tomcat -d /opt/tomcat tomcat
<b>#</b> passwd tomcat
</pre>

       <li>Tighten the permissions in <code><small>$CATALINA_HOME</small></code></li>
        <p>Change the user/group ownership <code><small>$CATALINA_HOME</small></code> to the <code><small>tomcat</small></code> user and <code><small>tomcat</small></code> group: </p>
<pre>
<b>#</b> cd /opt
<b>#</b> chown -R tomcat:tomcat apache-tomcat-6.0.32
<b>#</b> ls -ld  *tomcat*
drwxr-xr-x  9 <b>tomcat  tomcat</b>  4096 Jul 15 16:03 apache-tomcat-6.0.32
lrwxrwxrwx  1 root    other     20 Jul 15 19:00 tomcat -> apache-tomcat-6.0.32
</pre>
        <p>Change the user/ownership of the <code><small>$CATALINA_HOME/conf</small></code> directory to be owned by the <code><small>root</small></code> user, have a group of <code><small>tomcat</small></code> and have a permission of user/group read only:</p>

<pre>
<b>#</b> cd /opt/tomcat
<b>#</b> ls -l
total 92
drwxr-xr-x 2 tomcat  tomcat  4096 Jul 15 16:05 bin
drwxr-xr-x 2 tomcat  tomcat  4096 Jul 18 12:18 conf
drwxr-xr-x 2 tomcat  tomcat  4096 Jul 15 16:03 lib
drwxr-xr-x 2 tomcat  tomcat  4096 Feb  2 12:04 logs
drwxr-xr-x 2 tomcat  tomcat  4096 Jul 15 16:03 temp
drwxr-xr-x 7 tomcat  tomcat  4096 Jul 15 16:04 webapps
drwxr-xr-x 2 tomcat  tomcat  4096 Feb  2 12:04 work

<b>#</b> chown -R root:tomcat conf
<b>#</b> chmod -R 440 conf/*
<b>#</b> ls -l conf
total 92
-r--r----- 1 root    tomcat  9978 Feb  2 12:06 catalina.policy
-r--r----- 1 root    tomcat  3713 Feb  2 12:06 catalina.properties
-r--r----- 1 root    tomcat  1395 Feb  2 12:06 context.xml
-r--r----- 1 root    tomcat  1353 Jul 18 12:14 keystore
-r--r----- 1 root    tomcat  3257 Feb  2 12:06 logging.properties
-r--r----- 1 root    tomcat  6814 Jul 18 12:18 server.xml
-r--r----- 1 root    tomcat   210 Jul 18 12:10 tomcat-users.xml
-r--r----- 1 root    tomcat 51835 Feb  2 12:06 web.xml
</pre>

          <p>Change the user/ownership of the <code><small>$CATALINA_HOME/bin</small></code> and <code><small>$CATALINA_HOME/lib</small></code> directories to be owned by the <code><small>root</small></code> user and have a group of <code><small>tomcat</small></code>:</p>


<pre>
<b>#</b> chown -R root:tomcat lib
<b>#</b> chown -R root:tomcat bin
<b>#</b> ls -l
total 92
drwxr-xr-x 2 root    tomcat  4096 Jul 15 16:05 bin
drwxr-xr-x 2 root    tomcat  4096 Jul 18 12:18 conf
drwxr-xr-x 2 root    tomcat  4096 Jul 15 16:03 lib
drwxr-xr-x 2 tomcat  tomcat  4096 Feb  2 12:04 logs
drwxr-xr-x 2 tomcat  tomcat  4096 Jul 15 16:03 temp
drwxr-xr-x 7 tomcat  tomcat  4096 Jul 15 16:04 webapps
drwxr-xr-x 2 tomcat  tomcat  4096 Feb  2 12:04 work
</pre>
      </ol>
     </div> <!-- end Creating a dedicated Tomcat user/group subsection -->


     <div id="subsection">
      <h3>Resources</h3>
      <ul>
       <li><a href="http://marc.info/?t=104516038700003&r=1&w=2">Tomcat as root and security issues</a><br>      A lengthy thread in the <code><small>tomcat-users</small></code> mailing list archives dedicated to the perils of running Tomcat as the <code><small>root</small></code> user.</li>
      </ul>

     </div> <!-- end Resources subsection -->


   </div> <!-- end Tomcat Installation Permissions &amp; User/Group Ownership section -->




   <div id="section">
    <h2><a name="unused">Removing Unused Web Applications</a> </h2>
     
     <div id="subsection">
     <h3>Rationale</h3>

      <ul>
       <li>It is generally good practice to remove any un-used web applications out of <code>$CATALINA_HOME/webapps</code>.</li>
       <li>Tomcat "ships" with several default web applications you may want to consider removing if they are not being utilized:</li>
       <ul class="little">
        <li>The <code><small>ROOT</small></code> application is Tomcat's <code><small>DocumentRoot</small></code> and contains the server's main web page.  Give thought to the content that is placed in <code><small>ROOT/</small></code>, as it will be readily available.  (Note: if you want to utilize a <code><small>robots.txt</small></code> file to restrict crawler activity, <code><small>ROOT/</small></code> is the place it will go.)</li>
        <li>The <code><small>manager</small></code> application is used for remote management of web applications. To use this application, you must add a user with role of <code><small>manager-gui</small></code> in <code><small>tomcat-users.xml</small></code>.  Obviously, if you are not planning to use the <code><small>manager</small></code> application, it should be removed.</li>
        <li>The <code><small>host-manager</small></code> application is used for management of virtual hosts. To use this application, you must add a user with role of <code><small>admin-gui</small></code> in <code><small>tomcat-users.xml</small></code>.  If you are not planning to do a lot of virtual hosting in Tomcat this application should be removed.</li>
        <li>The <code><small>examples</small></code> application should probably be removed from a production server to minimize security exposure.</li>
        <li>The <code><small>docs</small></code> are a copy of the <a href="http://tomcat.apache.org/tomcat-6.0-doc/">Tomcat documentation found online</a>.  Unless you have need for a local copy, removing <code><small>docs</small></code>  would help to tidy-up <code><small>$CATALINA_HOME/webapps</small></code>.</li>
        </ul>
       </ul>
     </div> <!-- end Rationale subsection -->
     </div> <!-- end Resources subsection -->

   </div> <!-- end Removing Unused Web Applications section -->

   <div id="section">
    <h2><a name="digested">Using Digested Passwords</a> </h2>


     <div id="subsection">
      <h3>Rationale</h3>

      <div id="note" class="info">
       <h4>Tomcat Realms</h4>
       <p>A <a href="http://tomcat.apache.org/tomcat-6.0-doc/config/realm.html">realm</a> element represents a "database" of usernames, passwords, and roles (similar to Unix groups) assigned to those users.  </p>
      </div>

       <ul>
        <li>Passwords stored in clear text are a vulnerability if the host is compromised.</li>
        <li>Better to have the passwords encrypted using a cryptographic hash functions (SHA, MD2, or MD5) and then stored in <code><small>tomcat-users.xml</small></code> file in the Tomcat <code><small>conf/</small></code> directory. </li>
        <li>Tomcat can be configured to support digested passwords (this is not the default setting). </li>
        <li>How it works: When a client makes a request Tomcat will tell the client that a digested password is required. Based on this dialog, the client will automatically digest the password entered by the user.</li>
       </ul>

     </div> <!-- end subsection -->


     <div id="subsection">
      <h3><a name="useDigest"></a>Configure Tomcat to use digested passwords</h3>

<ol>
        <li>First we need to enable digest passwords support in Tomcat by modifying a couple of Tomcat Realms in the <code>server.xml</code> file in the Tomcat <code>conf/</code> directory. </li> 

          <p>A <a href="http://tomcat.apache.org/tomcat-6.0-doc/config/realm.html">Tomcat Realm</a> represents a "database" of usernames, passwords, and roles assigned to tomcat users.</p>

          <table>
           <tr>
            <th>  
             Realm Name
            </th>
            <th> 
             Purpose
            </th>
           </tr>

           <tr>
            <td> 
             <code>UserDatabaseRealm</code>
            </td>
            <td> 
              The <code>UserDatabaseRealm</code> is enabled by default and reads clear text user password information stored in <code>tomcat-users.xml</code>.
            </td>
           </tr>


           <tr>
            <td> 
             <code>MemoryRealm</code>
            </td>
            <td> 
              The <code>MemoryRealm</code> reads the user password information stored in the <code>tomcat-users.xml</code> in a specified encrypted format.
            </td>
           </tr>
          </table>

      
         <p>Open the <code><small>server.xml</small></code> with your favorite editor:</p>
<pre>
<b>$</b> vi server.xml
</pre>
        <p>Locate the <code><small>UserDatabaseRealm</small></code> (right above the <code><small>Host</small></code> element) and comment it out:</p>
<pre>
&lt;!-- This Realm uses the UserDatabase configured in the global JNDI
     resources under the key "UserDatabase".  Any edits
     that are performed against this UserDatabase are immediately
     available for use by the Realm.  --&gt;
<b>&lt;!--</b> 
&lt;Realm className="org.apache.catalina.realm.UserDatabaseRealm"
       resourceName="UserDatabase"/&gt;
<b>--&gt;</b>
&lt;!-- Define the default virtual host
     Note: XML Schema validation will not work with Xerces 2.2.
--&gt;
&lt;Host name="localhost"  appBase="webapps"
      unpackWARs="true" autoDeploy="true"
      xmlValidation="false" xmlNamespaceAware="false"&gt;
</pre>  



     <p>Now add the following <code><small>MemoryRealm</small></code> information below the commented out <code><small>UserDatabaseRealm</small></code>:</p>


<pre>
&lt;!-- This Realm uses the UserDatabase configured in the global JNDI
     resources under the key "UserDatabase".  Any edits
     that are performed against this UserDatabase are immediately
     available for use by the Realm.  --&gt;
&lt;!-- 
&lt;Realm className="org.apache.catalina.realm.UserDatabaseRealm"
       resourceName="UserDatabase"/&gt;
--&gt;
&lt;!-- Define the default virtual host
     Note: XML Schema validation will not work with Xerces 2.2.
--&gt;

 <b>&lt;Realm className="org.apache.catalina.realm.MemoryRealm" 
                 digest="SHA" /&gt;</b>

&lt;Host name="localhost"  appBase="webapps"
      unpackWARs="true" autoDeploy="true"
      xmlValidation="false" xmlNamespaceAware="false"&gt;

   
</pre>  
    <li><a name="makeDigest"></a>Create a SHA encrypted version of your password.</li>
     <p>Tomcat provides a script (<code><small>$CATALINA_HOME/bin/digest.sh</small></code>) that will encrypt a password string according to the algorithm specified.  Use this script as follows with the password you made for yourself previously:</p>

<pre>
<b>$</b> /home/tds/apache-tomcat-6.0.32/bin/digest.sh -a SHA secret
secret:e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4
</pre>  

     <li>Update <code>tomcat-users.xml</code>.</li>
     <p>Replace your clear-text password in <code><small>tomcat-users.xml</small></code> with the encrypted version:</p>

<pre>
&lt;tomcat-users&gt;
    &lt;role rolename="manager-gui"/&gt;
    &lt;user username="admin" password="<b>e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4</b>" roles="manager-gui"/&gt;
&lt;/tomcat-users&gt;
</pre>  
     <li>Verify digest passwords have been successfully enabled in Tomcat.</li>


      <div id="note" class="info">
       <h4>BASIC authentication</h4>
       <p>Since we are using BASIC authentication, you will need to clear any authenticated sessions in your browser to test whether digested passwords have been enabled.</p>
      </div>


  <p>Restart Tomcat and verify digest passwords have been successfully enabled by logging into the Tomcat <code><small>manager</small></code> application using your password in clear text: <a href="http://localhost:8080/manager/html/">http://localhost:8080/manager/html/</a></p>


      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting tips</h4>
       <ul>
        <li>Check the XML syntax in <code><small>tomcat-users.xml</small></code> and <code><small>server.xml</small></code> to make sure it is well-formed and without error.</li>
        <li>Did you restart Tomcat after you made your changes to <code><small>tomcat-users.xml</small></code> and <code><small>server.xml</small></code> ?</li>
        <li>Any errors will be reported in the <code><small>catalina.out</small></code> file in the Tomcat <code><small>logs/</small></code> directory. </li>
        <li>You do not need to type the encrypted version of your password into the browser (the browser auto-magically encrypts your password for you before it transmits it to the server).</li>
       </ul>
      </div>


     </div> <!-- end subsection -->



   </div> <!-- end Using Digested Passwords section -->

   <div id="section">
    <h2><a name="ssl">Enabling SSL Encryption</a> </h2>
     <div id="subsection">
      <div id="note" class="info">
       <h4>How SSL works</h4>
       <p>For more information on how SSL works, Wikipedia details the <a href="http://en.wikipedia.org/wiki/Transport_Layer_Security#How_it_works">steps involved</a> during an SSL transaction.</p>
      </div> 

     <h3>Rationale</h3>
      <ul>
       <li>Communication between two servers can be intercepted (i.e., an http transaction between client and server).</li>
       <li>An attacker can eavesdrop on the conversation and control the relay of messages between the victims, making them believe that they are talking directly to each other over a private connection.</li>
       <li>The use of digital certificates adds a layer of security by allowing the receiver of the message to verify the sender is who he or she claims to be.</li>
       <li>Any intercepted information that is encrypted also adds a layer of security (the attacker must take the extra step of unencrypting the data to view the message).</li>
       <li>Secure Sockets Layer (SSL), and more recently Transport Layer Security (TLS), is a cryptographic protocol that provides security and data integrity for communications over TCP/IP networks.</li>
       <li>SSL allows applications to communicate across a network in a way designed to prevent eavesdropping, tampering, and message forgery. </li>
       <li>SSL uses a cryptographic system that uses two keys to encrypt data: a public key known to everyone and a private or secret key known only to the recipient of the message.</li>
       <li>By convention, URLs that require an SSL connection start with <code>https</code> instead of <code>http</code>.</li>
      </ul>
     </div> <!-- end subsection -->

  


     <div id="subsection">
      <div id="note" class="info">
       <h4>CA-signed Certificates</h4>
       <p>A self-signed certificate says to your users <i>"Trust me - I am who I say I am."</i> </p>
       <p> A certificate signed by a CA says, <i>"Trust me - the CA agrees I am who I say I am."</i></p>
      </div> 

      <h3>SSL certificates</h3>
      <ul>
       <li>A public key certificate is an electronic document which incorporates a digital signature to bind together a public key with identity information of the certificate user.</li>
       <li>The certificate can be used to verify that a public key belongs to an individual.</li>
       <li>The digital signature can be signed by a Certificate Authority (CA) or the certificate user (a self-signed certificate).</li>
       <li>Unidata <i>highly recommends</i> the use of a certificate signed by a Certificate Authority (CA).</li>
       <li>Browser warnings for self-signed certificates can be very confusing to users.</li>
       <li>It's about trust: CA-signed certificates verify your identify to your users.  If the traffic between your server and the client is intercepted, an attacker can inject their own self-signed cert in the place of yours and the visitor will likely not notice.</li>
       <li>Self-signed certificates cannot (by nature) be revoked,  which may allow an attacker who has already gained access to monitor and inject data into a connection to spoof an identity if a private key has been compromised. CAs on the other hand have the ability to revoke a compromised certificate, which prevents its further use.</li>
      <ul>
     </div> <!-- end subsection -->


     <div id="subsection">
      <h3>Certificate <code>keystore</code> file</h3>
      <ul>
       <li>A <code>keystore</code> file stores the details of the SSL certificate necessary to make the protocol secured. </li>
       <li>The Tomcat documentation includes a section on <a href="http://tomcat.apache.org/tomcat-6.0-doc/ssl-howto.html#Prepare_the_Certificate_Keystore">importing your certificate into a keystore</a> file.</li>
       <li>Tomcat uses the <code>keystore</code> file for SSL transactions.</li>
      <ul>
     </div> <!-- end subsection -->


     <div id="subsection">
      <h3>Accessing the TDS remote management tool</h3>
       <p>Other than the compelling security reasons, you will want to enable SSL to take advantage of the TDS remote management tool which (out-of-the-box) requires SSL in order to access:
      <a href="http://localhost:8080/thredds/admin/debug">http://localhost:8080/thredds/admin/debug</a></p>
      <ol>

    
       <li><a name="enableSSL"></a>Configure Tomcat to enable SSL and use the self-signed certificate.</li>
       <div id="expanded" class="question">
        <p>Based on what we know about Tomcat configuration, which file in <code><small>$CATALINA_HOME/conf</small></code> should we edit to to enable SSL?</p>
       </div>
        <p>Open <code><small>$CATALINA_HOME/conf/server.xml</small></code> with your favorite editor:</p>

<pre>
<b>$</b> vi server.xml
</pre>
        <p>Locate the <code><small>Java HTTP/1.1 Connector</small></code> listening on port 8080 and verify it is redirecting SSL traffic to port 8443:</p>
<pre>
&lt;Connector port="8080" protocol="HTTP/1.1"
              connectionTimeout="20000"
              <b>redirectPort="8443"</b> /&gt;
</pre>
        <p>Find and uncomment the <code><small>SSL HTTP/1.1 Connector</small></code> listening on port 8443 to activate this connector:</p>
<pre>
&lt;Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"
              maxThreads="150" scheme="https" secure="true"
              clientAuth="false" sslProtocol="TLS" /&gt;
</pre>
        <p>Add a <code><small>keystoreFile</small></code> attribute to the <code><small>SSL HTTP/1.1 Connector</small></code> to tell Tomcat where to find your keystore:</p>
<pre>
&lt;Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"
              maxThreads="150" scheme="https" secure="true"
              clientAuth="false" sslProtocol="TLS" <b>keystoreFile="/home/tds/tds/apache-tomcat-6.0.32/conf/keystore"</b> /&gt;
</pre>

        <p>Since we opted to not use the default <code><small>keystore password</small></code>, we need to specify the new password so Tomcat can open the file:</p>
<pre>
&lt;Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"
              maxThreads="150" scheme="https" secure="true"
              clientAuth="false" sslProtocol="TLS" keystoreFile="/home/tds/tds/apache-tomcat-6.0.32/conf/keystore" <b>keystorePass="foobar"</b> /&gt;
</pre>


        <p>Finally, verify the <code><small>AprLifecycleListener</small></code> is uncommented (found near the top of the file):</p>
<pre>
&lt;!--APR library loader. Documentation at /docs/apr.html --&gt;
&lt;Listener className="org.apache.catalina.core.AprLifecycleListener" SSLEngine="on" /&gt;
</pre>

       <li>Verify SSL has been enabled.</li>


        <p>Restart Tomcat:</p>
<pre>
<b>$</b> $CATALINA_HOME/bin/shutdown.sh
<b>$</b> $CATALINA_HOME/bin/startup.sh
</pre>

        <p>Verify Tomcat is listening on port 8443 by running the <code><small>netstat</small></code> command:</p>

<pre>
<b>$</b> netstat -an | grep tcp | grep 8443
</pre>
      <div id="note" class="info">
       <h4><code>man netstat</code></h4>
       <p>Run <code><small>man netstat</small></code> in your terminal window to learn more about this command.</p>
      </div> 

        <p><code><small>netstat</small></code> (short for <b>net</b>work <b>stat</b>istics) is available on Unix, Unix-like, and Windows NT-based operating systems.  It is a command-line tool that displays:</p>
        <ul class="little">
         <li> network connections (both incoming and outgoing)</li>
         <li> routing tables</li>
         <li> and a number of network interface statistics</li>
        </ul> 



         <p>Look for the following in the output:</p>
<pre>
tcp        0      0 0.0.0.0:<b>8443</b>               0.0.0.0:*                   LISTEN
</pre>



      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting tips</h4>
       <ul>
        <li>Check the XML syntax in <code><small>server.xml</small></code> to make sure it is well-formed and without error.</li>
        <li>When generating the self-signed certificate, the last password (the <code><small>key password</small></code>) and <code><small>keystore password</small></code> should be the same (<code><small>changeit</small></code>). If they differ, Tomcat cannot open the keystore and you will get this error: <code><small>java.io.IOException: Cannot recover key</small></code>.</li>
        <li>Did you restart Tomcat after you made your changes to <code><small>server.xml</small></code>?</li>
        <li>Did you specify the full path to the <code><small>keystore</small></code> file in <code><small>server.xml</small></code>?</li>
       </ul>
      </div>
        <li>Modify <code><small>$CATALINA_HOME/conf/tomcat-users.xml</small></code> to add a new role with the rolename attribute of <code><small>tdsConfig</small></code>, and add this role to your list of roles:</li>
<pre>
&lt;tomcat-users&gt;
    &lt;role rolename="manager-gui"/&gt;
    &lt;role rolename="tdsConfig"/&gt;
    &lt;user username="admin" password="e5e9fa1ba31ecd1ae84f75caaa474f3a663f05f4" roles="manager-gui,tdsConfig"/&gt;
&lt;/tomcat-users&gt;
</pre>  
        <li>Restart Tomcat and try to access the TDS remote management tool: <a href="http://localhost:8080/thredds/admin/debug">http://localhost:8080/thredds/admin/debug/</a></li>
         <p><a href="../../images/ugly.png"><img src="../../images/ugly.png" width="400" height="433" alt="SSL warning for self-signed certificate"></a></p>
       </ol>

     </div> <!-- end subsection -->



     <div id="subsection">
      <h3>Configuring web applications for SSL</h3>
      <div id="expanded" class="question">
       <p>How did Tomcat know to use SSL for the TDS remote management tool?</p>
      </div>
      <div id="expanded" class="question">
       <p>Where, in any of the configuration changes you made to <code><small>$CATALINA_HOME/conf/server.xml</small></code> or <code><small>$CATALINA_HOME/conf/tomcat-users.xml</small></code>, did you explicitly specify that TDS remote management tool <i>must</i> be accessed via SSL?</p>       
      </div>
     </div> <!-- end subsection -->

     <div id="subsection">
      <h3>The missing piece: <code>/WEB-INF/web.xml</code></h3>
       <ul>
        
        <li>This is specified in the web application deployment descriptor, aka <code>web.xml</code>.</li>
        <li>Deployment descriptors are found in the <code>WEB-INF</code> directory of the web application: <code>&lt;application name&gt;/WEB-INF/web.xml</code>. </li>
        <li>By convention, Tomcat and other servlet containers will read the web application deployment descriptors for initialization parameters and container-managed security constraints upon application deployment.</li>
        <li>The TDS has been pre-configured to require that SSL encryption is enabled in order to access the remote management tool.</li>
       </ul>
     </div> <!-- end subsection -->



     <div id="subsection">
      <h3>Looking at the TDS deployment descriptor</h3>

 
        <ol>
         <li>Have a look at the deployment descriptor that comes with the TDS.</li>
          <p>Navigate to the unpacked <code><small>thredds</small></code> directory in <code><small>$CATALINA_HOME/webapps</small></code>, and view the file: </p>
<pre>
<b>$</b> cd /home/tds/tds/apache-tomcat-6.0.32/webapps/thredds
<b>$</b> less WEB-INF/web.xml
</pre>  
       <li>Look for a reference to the TDS remote management tool's URL (<code><small>/admin/debug</small></code>).</li>
         <p>Near the bottom of the deployment descriptor you will find this entry:</p>

<pre>
  &lt;!-- This allows "remote configuration":
    <b>/thredds/admin/debug</b> gives access to various debug and status info.
    /thredds/admin/content/ -&gt; "{tomcat_home}/content/thredds/"
    /thredds/admin/root/ -&gt; "{tomcat_home}/webapps/thredds/" DISABLED
    /thredds/admin/dataDir/path -&gt; "{dataRoot(path)}/webapps/thredds/"  DISABLED
   --&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;sensitive read access&lt;/web-resource-name&gt;
      <b>&lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;</b>
      &lt;http-method&gt;GET&lt;/http-method&gt;
      &lt;!-- http-method&gt;PUT&lt;/http-method --&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;role-name&gt;tdsConfig&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
    <b>&lt;user-data-constraint&gt;
      &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;</b>
  &lt;/security-constraint&gt;
</pre>

      <div id="note" class="info">
       <h4>Configuration help</h4>
       <p>For more information on how to configure security requirements for a web application in a deployment descriptor, see: <a href="http://java.sun.com/javaee/5/docs/tutorial/doc/bncbe.html">Defining Security Requirements for Web Applications</a>.</p>
      </div> 

       
       <ul class="little">
        <li>The <code><small>&lt;user-data-constraint&gt;</small></code> establishes a requirement that the constrained requests be received over a protected transport layer connection. This guarantees how the data will be transported between client and server. </li>
        <li><code><small>&lt;transport-guarantee&gt</small></code> choices for type of transport guarantee include <code><small>NONE</small></code>, <code><small>INTEGRAL</small></code>, and <code><small>CONFIDENTIAL</small></code>: </li>
        <ol class="little">
         <li>Specify <code><small>CONFIDENTIAL</small></code> when the application requires that data be transmitted so as to prevent other entities from observing the contents of the transmission. (E.g., via SSL.)</li>
         <li>Specify <code><small>INTEGRAL</small></code> when the application requires that the data be sent between client and server in such a way that it cannot be changed in transit. </li>
          <li>Specify <code><small>NONE</small></code> to indicate that the container must accept the constrained requests on any connection, including an unprotected one.</li>
         </ol>
        </ul>
       </ol>
     </div> <!-- end subsection -->



     <div id="subsection">
      <div id="note" class="info">
       <h4>Changes to the <code>manager</code> application</h4>
       <p>The <code><small>manager</small></code> application URLs and roles has been re-structured. See the Tomcat <a href="http://tomcat.apache.org/migration.html">Migration guide</a> for more information.</p>
      </div>
      <h3><a name="managerSSL"></a>Enabling SSL for the Tomcat <code>manager</code> application</h3>
      <ol>
       <li>Modify the deployment descriptor of the Tomcat <code>manager</code> application.</li>
        <ul class="little">
        <li><b>If you are using Tomcat version 6.0.29 or older:</b></li>

        <p>Using your favorite editor, open the deployment descriptor for the Tomcat <code><small>manager</small></code> application:</p>
<pre>
<b>$</b> vi $CATALINA_HOME/webapps/manager/WEB-INF/web.xml
</pre>   


        <p>Locate the <code><small>&lt;security-constraint&gt;</small></code> element (near the bottom of the file):</p>
<pre>
  &lt;!-- Define a Security Constraint on this Application --&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;HTMLManger and Manager command&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/jmxproxy/*&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/html/*&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/list&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/expire&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/sessions&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/start&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/stop&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/install&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/remove&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/deploy&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/undeploy&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/reload&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/save&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/serverinfo&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/status/*&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/roles&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/resources&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;!-- NOTE:  This role is not present in the default users file --&gt;
       &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
</pre>

        <p>Add a <code><small>&lt;user-data-constraint&gt;</small></code> with a <code><small>&lt;transport-guarantee&gt;</small></code> of <code><small>CONFIDENTIAL</small></code> to enable port-forwarding to port 8443:</p>
<pre>
  &lt;!-- Define a Security Constraint on this Application --&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;HTMLManger and Manager command&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/jmxproxy/*&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/html/*&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/list&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/expire&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/sessions&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/start&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/stop&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/install&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/remove&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/deploy&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/undeploy&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/reload&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/save&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/serverinfo&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/status/*&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/roles&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/resources&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
   <b> &lt;user-data-constraint&gt;
       &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;</b>
  &lt;/security-constraint&gt;
</pre>
        <li><b>If you are using Tomcat version 6.0.30 or 6.0.32:</b></li>


        <p>Using your favorite editor, open the deployment descriptor for the Tomcat <code><small>manager</small></code> application:</p>
<pre>
<b>$</b> vi $CATALINA_HOME/webapps/manager/WEB-INF/web.xml
</pre>   


        <p>Locate the <code><small>&lt;security-constraint&gt;</small></code> element (near the bottom of the file):</p>
<pre>
  &lt;!-- Define a Security Constraint on this Application --&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;Manager commands&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/list&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/expire&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/sessions&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/start&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/stop&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/install&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/remove&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/deploy&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/undeploy&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/reload&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/save&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/serverinfo&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/roles&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/resources&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/findleaks&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;!-- NOTE: 1. These roles are not present in the default users file
                  2. The manager role is deprecated, it will be removed in
                     Tomcat 7.
                  3. Use the manager-script role to take advantage of the new
                     CSRF protection. Using the manager role or assigning both
                     the manager-script and manager-gui roles to the same user
                     will bypass the CSRF protection. --&gt;
       &lt;role-name&gt;manager-script&lt;/role-name&gt;
       &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;HTML Manager commands&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/html/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;!-- NOTE: 1. These roles are not present in the default users file
                  2. The manager role is deprecated, it will be removed in
                     Tomcat 7.
                  3. Use just the manager-gui role to take advantage of the new
                     CSRF protection. Assigning the manager role or manager-gui
                     role along with either the manager-script or manager-jmx
                     roles to the same user will bypass the CSRF protection. --&gt;
       &lt;role-name&gt;manager-gui&lt;/role-name&gt;
       &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;

  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;JMX proxy&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/jmxproxy/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;!-- NOTE: 1. These roles are not present in the default users file
                  2. The manager role is deprecated, it will be removed in
                     Tomcat 7.
                  3. Use the manager-jmx role to take advantage of the new
                     CSRF protection. Using the manager role or assigning both
                     the manager-jmx and manager-gui roles to the same user
                     will bypass the CSRF protection. --&gt;
       &lt;role-name&gt;manager-jmx&lt;/role-name&gt;
       &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;Status&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/status/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;!-- NOTE: 1. These roles are not present in the default users file
                  2. The manager role is deprecated, it will be removed in
                     Tomcat 7. --&gt;
       &lt;role-name&gt;manager-status&lt;/role-name&gt;
       &lt;role-name&gt;manager-gui&lt;/role-name&gt;
       &lt;role-name&gt;manager-script&lt;/role-name&gt;
       &lt;role-name&gt;manager-jmx&lt;/role-name&gt;
       &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;

</pre>
        <p>The  <code><small>manager</small></code> application deployment descriptor for these later versions of Tomcat 6 has been modified to be similar to the configuration the <code><small>manager</small></code> application as it appears in Tomcat 7.  The deployment descriptor contains a <code><small>&lt;security-constraint&gt;</small></code> section for three of the <code><small>ContactPaths</small></code> (as per <a href="http://tomcat.apache.org/migration.html#Manager_application">Manager Application section of the Tomcat Migration Guide</a>), as well as a 'catch all' <code><small>&lt;security-constraint&gt;</small></code> to handle the various script-oriented <code><small>manager</small></code> commands found in earlier versions of Tomcat 6.</p>

        <p>Add a <code><small>&lt;user-data-constraint&gt;</small></code> with a <code><small>&lt;transport-guarantee&gt;</small></code> of <code><small>CONFIDENTIAL</small></code> for the desired <code><small>ContactPaths</small></code> to to enable port-forwarding to port 8443:</p>

<pre>
  &lt;!-- Define a Security Constraint on this Application --&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;Manager commands&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/list&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/expire&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/sessions&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/start&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/stop&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/install&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/remove&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/deploy&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/undeploy&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/reload&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/save&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/serverinfo&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/roles&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/resources&lt;/url-pattern&gt;
      &lt;url-pattern&gt;/findleaks&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;!-- NOTE: 1. These roles are not present in the default users file
                  2. The manager role is deprecated, it will be removed in
                     Tomcat 7.
                  3. Use the manager-script role to take advantage of the new
                     CSRF protection. Using the manager role or assigning both
                     the manager-script and manager-gui roles to the same user
                     will bypass the CSRF protection. --&gt;
       &lt;role-name&gt;manager-script&lt;/role-name&gt;
       &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
    <b>&lt;user-data-constraint&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;</b>
  &lt;/security-constraint&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;HTML Manager commands&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/html/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;!-- NOTE: 1. These roles are not present in the default users file
                  2. The manager role is deprecated, it will be removed in
                     Tomcat 7.
                  3. Use just the manager-gui role to take advantage of the new
                     CSRF protection. Assigning the manager role or manager-gui
                     role along with either the manager-script or manager-jmx
                     roles to the same user will bypass the CSRF protection. --&gt;
       &lt;role-name&gt;manager-gui&lt;/role-name&gt;
       &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
    <b>&lt;user-data-constraint&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;</b>
  &lt;/security-constraint&gt;

  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;JMX proxy&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/jmxproxy/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;!-- NOTE: 1. These roles are not present in the default users file
                  2. The manager role is deprecated, it will be removed in
                     Tomcat 7.
                  3. Use the manager-jmx role to take advantage of the new
                     CSRF protection. Using the manager role or assigning both
                     the manager-jmx and manager-gui roles to the same user
                     will bypass the CSRF protection. --&gt;
       &lt;role-name&gt;manager-jmx&lt;/role-name&gt;
       &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
    <b>&lt;user-data-constraint&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;</b>
  &lt;/security-constraint&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;Status&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/status/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;!-- NOTE: 1. These roles are not present in the default users file
                  2. The manager role is deprecated, it will be removed in
                     Tomcat 7. --&gt;
       &lt;role-name&gt;manager-status&lt;/role-name&gt;
       &lt;role-name&gt;manager-gui&lt;/role-name&gt;
       &lt;role-name&gt;manager-script&lt;/role-name&gt;
       &lt;role-name&gt;manager-jmx&lt;/role-name&gt;
       &lt;role-name&gt;manager&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
    <b>&lt;user-data-constraint&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;</b>
  &lt;/security-constraint&gt;

</pre>
        <li><b>If you are using Tomcat 7:</b></li>

        <p>Using your favorite editor, open the deployment descriptor for the Tomcat <code><small>manager</small></code> application:</p>
<pre>
<b>$</b> vi $CATALINA_HOME/webapps/manager/WEB-INF/web.xml
</pre>   


        <p>Locate the <code><small>&lt;security-constraint&gt;</small></code> elements (near the bottom of the file):</p>
<pre>
  &lt;!-- Define a Security Constraint on this Application --&gt;
  &lt;!-- NOTE:  None of these roles are present in the default users file --&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;HTML Manager interface (for humans)&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/html/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;role-name&gt;manager-gui&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;Text Manager interface (for scripts)&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/text/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;role-name&gt;manager-script&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;JMX Proxy interface&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/jmxproxy/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;role-name&gt;manager-jmx&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;Status interface&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/status/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;role-name&gt;manager-gui&lt;/role-name&gt;
       &lt;role-name&gt;manager-script&lt;/role-name&gt;
       &lt;role-name&gt;manager-jmx&lt;/role-name&gt;
       &lt;role-name&gt;manager-status&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;

</pre>
        <p>The Tomcat 7 version of the <code><small>manager</small></code> application deployment descriptor contains a <code><small>&lt;security-constraint&gt;</small></code> section for each of the four possible <code><small>ContactPaths</small></code> (as per <a href="http://tomcat.apache.org/migration.html#Manager_application">Manager Application section of the Tomcat Migration Guide</a>).</p>

        <p>Add a <code><small>&lt;user-data-constraint&gt;</small></code> with a <code><small>&lt;transport-guarantee&gt;</small></code> of <code><small>CONFIDENTIAL</small></code> for the desired <code><small>ContactPaths</small></code> to to enable port-forwarding to port 8443:</p>
<pre>
  &lt;!-- Define a Security Constraint on this Application --&gt;
  &lt;!-- NOTE:  None of these roles are present in the default users file --&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;HTML Manager interface (for humans)&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/html/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;role-name&gt;manager-gui&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
    <b>&lt;user-data-constraint&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;</b>
  &lt;/security-constraint&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;Text Manager interface (for scripts)&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/text/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;role-name&gt;manager-script&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
   <b> &lt;user-data-constraint&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;</b>
  &lt;/security-constraint&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;JMX Proxy interface&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/jmxproxy/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;role-name&gt;manager-jmx&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
   <b> &lt;user-data-constraint&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;</b>
  &lt;/security-constraint&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;Status interface&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/status/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
       &lt;role-name&gt;manager-gui&lt;/role-name&gt;
       &lt;role-name&gt;manager-script&lt;/role-name&gt;
       &lt;role-name&gt;manager-jmx&lt;/role-name&gt;
       &lt;role-name&gt;manager-status&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
   <b> &lt;user-data-constraint&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;</b>
  &lt;/security-constraint&gt;

</pre>
        </ul>

      </ul>
     <li>Verify SSL has been enabled for the Tomcat <code>manager</code> application.</li>
      <p>Restart Tomcat and verify SSL has been enabled for the Tomcat <code>manager</code> application: <a href="http://localhost:8080/manager/html/">http://localhost:8080/manager/html/</a></li></p>

      <p><a href="../../images/managerssl.png"><img src="../../images/managerssl.png" width="500" height="138" alt="Tomcat manager authentication prompt"></a></p>


      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting tips</h4>
       <ul>
        <li>Check the XML syntax in <code><small>web.xml</small></code> to make sure it is well-formed and without error.</li>
        <li>Did you specify a <code><small>&lt;transport-guarantee&gt;</small></code> of <code><small>CONFIDENTIAL</small></code>? </li>
        <li>Did you restart Tomcat after you made your changes to <code><small>web.xml</small></code>?</li>
       </ul>
      </div>
     </ol>


    </div> <!-- end subsection -->
   <div id="subsection">
      <h3>Resources</h3>
      <ul>
       <li><a href="http://tomcat.apache.org/tomcat-6.0-doc/ssl-howto.html">SSL Configuration HOW-TO</a><br>      The Apache Tomcat document detailing how to enable SSL.</li>
       <li><a href="http://tomcat.apache.org/migration.html#Manager_application">Tomcat Migration Guide</a><br>      A document detailing the various changes between Tomcat versions.</li>
       <li><a href="http://www.sslshopper.com/article-when-are-self-signed-certificates-acceptable.html">When are self-signed certificates acceptable?</a><br>      A compelling argument as to why self-signed certificates should not be used in a production environment.</li>
      </ul>


    </div> <!-- end subsection -->

   </div> <!-- end Enabling SSL Encryption section -->





   <div id="section">
    <h2><a name="ports">Blocking Non-Essential Port Access At The Firewall</a> </h2>
     <div id="subsection">
     <h3>Rationale</h3>
      <ul>
       <li>It is easy to issue commands to Tomcat if you know:</li>
       <ol class="little">
         <li>the correct port number; and 
         <li>the command expected on that port.
        </ol>
       <li>Unless you are on a private network, you need a firewall to restrict who is allowed to access network ports.</li>
       <li>We recommend working with your systems/network administrator to block access to all non-essential ports at the firewall.</li>
      </ul>
     </div> <!-- end subsection -->


     <div id="subsection">
     <h3>Port Tinkering</h3>
      <ol>
       <li>Shutdown Tomcat without using the <code><small>$CATALINA_HOME/bin/shutdown.sh</small></code> script.</li>
        <p>Make sure Tomcat is running and then type the following in your terminal window:</p>  
<pre>
<b>$</b> telnet localhost 8005
</pre>
       <p>When prompted, issue Tomcat the shutdown command by typing <code><small>SHUTDOWN</small></code>:</p>
<pre>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
<b>SHUTDOWN</b>
</pre>
      <div id="expanded" class="question">
       <p> What happened when you issued the <code><small>SHUTDOWN</small></code> command via telnet?  Is this what you expected?</p>
      </div>
      </ol>  
     </div> <!-- end subsection --> 
     <div id="subsection">

     <h3>For running the TDS, keep in mind the following:  </h3>
     <ul>
         <li>Port 8080 should have unrestricted access <i>unless</i> you plan to proxy requests to Tomcat from and HTTP server.</li>
         <li>If you are allowing any remote management by using the TDS Remote Management Tool or the Tomcat <code>manager</code> application, you must also open up port 8443.</li>
        </ul> 
     </div> <!-- end subsection -->



     <div id="subsection">
      <h3>Resources</h3>
      <ul>
       <li><a href=http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch14_:_Linux_Firewalls_Using_iptables">Linux Firewalls Using  <code><small>iptables</small></code></a><br>      An article showing how to set up a firewall on a linux server.</li>
      <li>Your local systems/network administrator:<br> 
<img src="../../images/super.png" alt="systems/network administrator"></li>
        
      </ul>

     </div> <!-- end Resources subsection -->
   </div> <!-- end Blocking Non-Essential Port Access At The Firewall section -->




   <div id="section">
    <h2><a name="access">Restricting Access To The TDS By Remote IP Address Or Host</a> </h2>
     <div id="subsection">

      <div id="note" class="info">
       <h4>Tomcat Valves</h4>
       <p>A <a href="http://tomcat.apache.org/tomcat-6.0-doc/config/valve.html">valve</a> element represents a component that will be inserted into the request processing pipeline for the associated Catalina container. </p>
      </div>

     <h3>Rationale</h3>
      <ul>
       <li>Use the Tomcat <code>RemoteHostValve</code> or <code>RemoteAddrValve</code> to restrict access to the TDS and/or other web applications.</li>
       <li>Configured in the Tomcat <code>conf/server.xml</code> file.</li>
       <li>Valve declarations can be used to either <i>allow</i> or <i>deny</i> access to content.</li>
       <li>Utilize the valves for adding an extra layer of security to the <code>manager</code> application to limit accessed to it from within a specific IP address range.</li>
       <li>Caveat: these valves rely on incoming IP addresses or hostnames which are vulnerable to spoofing.  Also, not much help when dealing with DHCP.</li>
      </ul>
     </div> <!-- end subsection -->


     <div id="subsection">
     <h3>Examples</h3>
      <ol>
       <li>Using the <code>RemoteAddrValve</code> to restrict access based on IP addresses.</li>
<pre>
&lt;!-- This example denies access based on IP addresses --&gt;
&lt;Valve className="org.apache.catalina.valves.RemoteAddrValve"
       deny="128\.117\.47\.201,128\.107\.157\.210,96\.33\.56\.215" /&gt;
</pre>
       <li>Using the <code>RemoteHostValve</code> to restrict access based on resolved host names.</li>
<pre>
&lt;!-- This example denies access based on host names --&gt;
&lt;Valve className="org.apache.catalina.valves.RemoteHostValve"
           deny="www\.badguys\.com,www\.bandwidthhog\.net" /&gt;
</pre>
       <li>Using wildcard characters.</li>
<pre>
&lt;!-- Wildcard characters can with the both valves --&gt;
&lt;Valve className="org.apache.catalina.valves.RemoteAddrValve"
       deny="128\.117\.47\..*" /&gt;
</pre>
       <li>Using the <code>RemoteAddrValve</code> to limit access to a specific range of IP addresses.</li>
<pre>
&lt;!-- This example only allows the specified IPs to access  --&gt;
&lt;Valve className="org.apache.catalina.valves.RemoteAddrValve"
          allow="128\.117\.140\..*" /&gt;
</pre>


      </ol>  
     </div> <!-- end subsection --> 



     <div id="subsection">
      <h3>Resources</h3>
      <ul>
       <li><a href=http://tomcat.apache.org/tomcat-6.0-doc/config/valve.html">The Valve Component</a><br>      Tomcat documentation about the various <code>valve</code> components available for use.</li>
      </ul>

     </div> <!-- end Resources subsection -->
   </div> <!-- end Restricting Access To The TDS By Remote IP Address Or Host section -->


   <div id="section">
    <h2><a name="manager">Securing the Tomcat <code>manager</code> Application</a> </h2>

     <div id="subsection">
      <div id="note" class="info">
       <h4>Changes to the <code>manager</code> application</h4>
       <p>The <code><small>manager</small></code> application URLs and roles has been re-structured. See the Tomcat <a href="http://tomcat.apache.org/migration.html">Migration guide</a> for more information.</p>
      </div>
     <h3>Rationale</h3>

      <ul>
       <li>"Free" web application that comes with Tomcat distribution that lives in the Tomcat Lives in the <code>$CATALINA_HOME/webapps/manager</code> directory. </li>
       <li>Not enabled by default.</li>
       <li>Allows Tomcat administrators to deploy, undeploy, or reload web applications such as the TDS without having to shut down and restart Tomcat.</li>
       <li>If exploited, an attacker can use the <code><small>manager</small></code> application to install programs on your server willy-nilly.</li>
       <li>If you choose to enable the <code><small>manager</small></code> application, we <i>highly recommend</i> enabling digested passwords and SSL encryption for the <code><small>manager</small></code>.</li>
       <li>Restricting access to the  <code><small>manager</small></code> application to a small subset of IP addressess or host names using a Tomcat valve, etc., is also a good idea.</li>
       <li>Uninstall this application if you don't plan to use it.</li>
      </ul>
     </div> <!-- end Rationale subsection -->

     <div id="subsection">
      <h3>Resources</h3>
      <ul>
       <li><a href="http://tomcat.apache.org/tomcat-6.0-doc/manager-howto.html">Manager App HOW-TO</a><br>      The Apache Tomcat document referencing how to use and configure the <code>manager</code> application.</li>
       <li><a href="http://tomcat.apache.org/migration.html#Manager_application">Tomcat Migration Guide</a><br>      A document detailing the various changes between Tomcat versions contains a section dedicated to the  <code>manager</code> application.</li>
      </ul>

     </div> <!-- end Resources subsection -->
   </div> <!-- end Securing the Tomcat manager Application section -->


   <div id="section">
    <h2><a name="proxy">Reverse Proxy</a> </h2>
     <div id="subsection">
     <h3>Rationale</h3>
      <ul>
       <li>A reverse proxy is a proxy server that appears to clients to be an ordinary server. Requests are forwarded to one or more origin servers which handle the request. The response is returned as if it came directly from the proxy server.</li>
        <img src="../../images/tds_reverse_proxy.png" alt="Reverse Proxy For The TDS">
       <li>Reverse proxies can be used to hide the existence and characteristics of the origin server(s) and can be an additional layer of defense and can protect against some OS and web server specific attacks. This additional security layer forces an attacker to attack the proxy because the firewall allows only the proxy to communicate with the back-end content servers.
</li>
        <li>However, it does not provide any protection to attacks against vulnerabilities in the web application or proxy service itself (e.g., Apache, Tomcat).</li>
        <li>If an attacker can use the front-end proxy server to launch an attack on the back-end servers if he/she manages to exploit the web application, proxy transaction or some other service running on the proxy server.
</li>
      </ul>
     </div> <!-- end subsection -->

     <div id="subsection">
      <h3>Resources</h3>
      <ul>
       <li><a href="/projects/THREDDS/tech/tds4.2/reference/TomcatBehindProxyServer.html">Running The TDS Behind a Proxy Server</a><br>      How to set up a reverse proxy for the TDS using Tomcat and the Apache HTTP server.</li>
      </ul>

     </div> <!-- end Resources subsection -->
   </div> <!-- end Reverse Proxy section -->

   <div id="section">
    <h2><a name="jvm">Running Tomcat with a Security Manager</a> </h2>
     <div id="subsection">
     <h3>Rationale</h3>
      <ul>
       <li>The JVM Security Manager that comes with Tomcat imposes a fine-grained security restrictions to all Java applications running the JVM. </li>
       <li>It confines the Java applications in a sandbox, and restricts them from utilizing certain features of the Java language Tomcat normally is able to access.</li>
        <li>If you are hosting untrusted servlets or JSP on your server, then implementing the Security Manager may be a good idea. </li>
        <li>Be aware the Security Manager may prevent trusted web applications (like the TDS) from performing certain functions if configured too restrictively.</li>
      </ul>
     </div> <!-- end subsection -->

     <div id="subsection">
      <h3>Resources</h3>
      <ul>
       <li><a href="http://tomcat.apache.org/tomcat-6.0-doc/security-manager-howto.html">Security Manager HOW-TO</a><br>      Information on the default settings of the Java Security Manager and instructions on how to make changes to these settings.</li>
      </ul>

     </div> <!-- end Resources subsection -->
   </div> <!-- end Java Security section -->

  <div id="section">
    <h2><a name="shutdown">Protecting the Tomcat <code>SHUTDOWN</code> Port</a> </h2>
     <div id="subsection">
     <h3><code>SHUTDOWN</code> on port 8005</h3>
      <ul>
       <li>Tomcat uses a the default port of 8005 as the designated shutdown port.  Shutdown scripts make a call to this port and issue the <code>SHUTDOWN</code> command.</li>
       <li>If you are running a publicly accessible server make sure you prevent external access to the shutdown port by using a suitable firewall. </li>
       <li>If need be, you can always change the shutdown command or even the port number in <code>$CATALINA_HOME/conf/server.xml</code>. </li>
     </ul>
     </div> <!-- end subsection -->

   </div> <!-- end  section -->


   <div id="section">
    <h2><a name="versioninfo">Remove Tomcat Version String From HTTP Error Messages</a> </h2>
     <div id="subsection">
     <h3>Tomcat Version Information</h3>
     <ul>
       <li>By default, the Tomcat version number will be displayed on any HTTP error pages displayed by Tomcat.</li>
       <li>Remove the Tomcat version string from HTTP error messages by repacking <code><small>$CATALINA_HOME/lib/catalina.jar</small></code> with an updated <code><small>ServerInfo.properties</small></code> file.</li>      
     </ul>
     <ol>
      <li>Unpack <code><small>catalina.jar</small></code></li>
<pre>
<b>$</b> cd $CATALINA_HOME/lib
<b>$</b> jar xf catalina.jar org/apache/catalina/util/ServerInfo.properties
</pre>
      <li>Update <code><small>ServerInfo.properties</small></code> by changing <code><small>server.info</small></code>  line to <code><small>server.info=Apache Tomcat</small></code>.  Repackage <code><small>catalina.jar</small></code></li>
<pre>
<b>$</b> jar uf catalina.jar org/apache/catalina/util/ServerInfo.properties
</pre>

       <li>Remove the  <code>$CATALINA_HOME/lib/org</code> directory created when extracting the <code><small>ServerInfo.properties</small></code>  file)</li>
<pre>
<b>$</b> rm -r org
</pre>
      </ol>     
     </div> <!-- end subsection -->

   </div> <!-- end  section -->


   <p><img src="../../images/thread.png" height="60" alt="THREDDS" valign="top" align="left" vspace="0" hspace="10" />  This document is maintained by Unidata.  Send comments to <a href="mailto:support-thredds@unidata.ucar.edu">THREDDS support</a>.</p>

   
  </body>
 </html>   

