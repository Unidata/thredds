<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
 <html>
  <head>
   <title>TDS Tutorial: Getting Started</title>
   <link rel="stylesheet" href="tutorial.css" type="text/css" /> 
   <link rel="SHORTCUT ICON" href="http://www.unidata.ucar.edu/favicon.ico" type="image/x-icon" />
  </head>
  <body>

   <h1>TDS Tutorial: Getting Started</h1>    
   <div id="section">
    <h2><a name="install">Installing Java and Tomcat</a></h2>


     <div id="subsection">
      <h3>System requirements</h3>

      <div id="note" class="info">
       <h4>Installation help</h4>
       <p>Users of GCJ and OS-provided packages (linux) for Java and/or Tomcat may want to reference the <a href="http://www.unidata.ucar.edu/mailing_lists/archives/thredds/">THREDDS mailing list</a> for installation help.</p>
       <p>Note: TDS version 4.3 will require the use of Tomcat 7.</p>
      </div> 

       <ul>        
        <li>Sun Java 1.6 (latest version)</li>       
        <li>Apache Tomcat 5.5 or above (we recommend the latest version of Tomcat 6.0)</li>  
       </ul>
       <p>While there are different distributors of Java and servlet containers, Unidata develops, uses and tests the THREDDS Data Server using <i>Sun Java</i> and the <i>Apache Tomcat</i> servlet container.</p>
     </div> <!-- end subsection -->



     <div id="subsection">
      <h3>Installing Java</h3>
      <ol>
       <li><a href="http://java.sun.com/javase/downloads/">Download</a> current Java SE Developer Kit (JDK) from Sun.</li>
        <p>At the time of this workshop, that is version <i>1.6.0_26</i>.  We will be using the Linux x64-bit, <i>non-rpm</i>, self-extracting file:</p>
        <p><code>jdk-6u26-linux-x64.bin</code></p>
       <li>Install the JDK as per the Sun <a href="http://java.sun.com/javase/6/webnotes/install/">installation instructions</a>.</li>
        <p>Copy the self-extracting file to the installation directory (<code><small>~/GettingStarted</small></code> is the installation directory in this example):</p>

<pre>
<b>$</b> pwd
/home/tds

<b>$</b> cp Downloads/jdk-6u26-linux-x64.bin GettingStarted/ 
<b>$</b> cd GettingStarted
</pre>

        <p>Change the permissions on the file to be executable:</p>  

<pre>
<b>$</b> ls -l  
-rw-r--r-- 1 tds Unidata 85407904 Jul 11 17:26 jdk-6u26-linux-x64.bin

<b>$</b> chmod 775 jdk-6u26-linux-x64.bin  

<b>$</b> ls -l  
-rwxrwxr-x 1 tds Unidata 85407904 Jul 11 17:26 jdk-6u26-linux-x64.bin
</pre>

        <p>Run self-extracting file and agree to the terms of the code license:</p>

<pre>
<b>$</b> ./jdk-6u26-linux-x64.bin 
</pre>

        <p>This will extract the JDK in the <code><small>~/GettingStarted</small></code> directory:</p>

<pre>
<b>$</b> ls -l 
drwxr-xr-x 10 tds Unidata     4096 Jul 11 17:35 jdk1.6.0_26
-rwxrwxr-x  1 tds Unidata 85407904 Jul 11 17:26 jdk-6u26-linux-x64.bin
</pre>
      </ol>

      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting tips</h4>
       <ul>
        <li>Check to make sure the JDK self-extracting file has the correct permissions and is executable.</li>
        <li>If you receive an error while running the self-extracting file, you may have downloaded the wrong type of JDK for your machine.</li>
        <li>Depending on your OS you may need install <i>both</i> the 32-bit and 64-bit self-extracting files.</li>
       </ul>
      </div>

     </div> <!-- end subsection -->





     <div id="subsection">
      <h3>Installing Tomcat</h3>
      <ol>
       <li><a href="http://tomcat.apache.org/">Download</a> current version of the Tomcat servlet container.</li>
        <p>At the time of this workshop, that is version <i>6.0.32</i>. We will be using the core binary tar.gz file:</p>
        <p><code>apache-tomcat-6.0.32.tar.gz</code></p>
       <li>Install Tomcat as per the Apache Tomcat <a href="http://tomcat.apache.org/tomcat-6.0-doc/setup.html">installation instructions</a>.</li>
        <p>Copy the binary tar.gz file to the installation directory (<code><small>~/GettingStarted</small></code> is the installation directory in this example):</p>

<pre>
<b>$</b> pwd
/home/tds/GettingStarted

<b>$</b> cp ~/Downloads/apache-tomcat-6.0.32.tar.gz . 
</pre>

        <p>Unpack the archive to create Tomcat directory:</p>  

<pre>
<b>$</b> tar xvzf apache-tomcat-6.0.32.tar.gz

<b>$</b> ls -ld apache-tomcat-6.0.32
drwxr-xr-x 9 tds Unidata 4096 Jul 11 17:47 apache-tomcat-6.0.32
</pre>
      </ol>
     </div> <!-- end subsection -->




      <div id="subsection" class="exercise">
       <h3>Exercise One: Install Java and Tomcat</h3>
       <ol>
        <li>Using the steps outlined in the above sections, install the JDK and Tomcat in <code>/home/tds/GettingStarted</code></li>

       </ol>
      </div>  <!-- end exercise one -->


   </div> <!-- end Installing Java & Tomcat section -->








   <div id="section">
    <h2><a name="tour">Tomcat Directory Structure: Quick Tour</a></h2>


     <div id="subsection">
      <h3>Exploring the Tomcat directory structure</h3>
      <ol>
       <li>Examine the Tomcat directory structure, aka <code>$CATALINA_HOME</code> (also can be called <code>$TOMCAT_HOME</code>). </li>
        <p>Move into <code><small>$CATALINA_HOME</small></code> and do a long listing:</p>
<pre>
<b>$</b> cd apache-tomcat-6.0.32
<b>$</b> ls -l 
total 92
drwxr-xr-x 2 tds Unidata  4096 Jul 11 17:47 bin
drwxr-xr-x 2 tds Unidata  4096 Feb  2 12:06 conf
drwxr-xr-x 2 tds Unidata  4096 Jul 11 17:47 lib
-rw-r--r-- 1 tds Unidata 37951 Feb  2 12:06 LICENSE
drwxr-xr-x 2 tds Unidata  4096 Feb  2 12:04 logs
-rw-r--r-- 1 tds Unidata   558 Feb  2 12:06 NOTICE
-rw-r--r-- 1 tds Unidata  8672 Feb  2 12:04 RELEASE-NOTES
-rw-r--r-- 1 tds Unidata  6670 Feb  2 12:06 RUNNING.txt
drwxr-xr-x 2 tds Unidata  4096 Jul 11 17:47 temp
drwxr-xr-x 7 tds Unidata  4096 Feb  2 12:04 webapps
drwxr-xr-x 2 tds Unidata  4096 Feb  2 12:04 work
</pre>

       <li>Familiarize yourself with the following important directories.</li>

        <p><code>bin/</code></p>
         <ul class="little">
          <li>Contains <code><small>startup.sh</small></code>, <code><small>shutdown.sh</small></code> and other scripts/programs.</li>
          <li>The <code><small>*.sh files</small></code>  (for Unix systems) are functional duplicates of the <code><small>*.bat</small></code>  files (for Windows systems).</li>
         </ul>
        <p><code>conf/</code></p>
         <ul class="little">
          <li><i>Server-wide</i> Tomcat configuration.</li>
          <li>You will modify <code><small>server.xml</small></code> and <code><small>tomcat-users.xml</small></code> to adjust logging, authentication and access control, enable SSL, etc.</li>
          <li>Web applications can override some server-wide settings in their own configuration files (more about that later).</li>
         </ul>

        <p><code>webapps/</code></p>
         <ul class="little">
          <li>Contains web applications directories and WAR files.</li>
          <li>This is where we will be putting the TDS web application.</li>
          <li>You will also be using the <code><small>manager</small></code> application that comes with Tomcat during this workshop.</li>
         </ul>

        <p><code>logs/</code></p>

         <ul class="little">
          <li><i>Tomcat log files</i> are here by default.</li>
          <li>This is one of the directories you will be looking for log files (the TDS logs elsewhere by default).</li>
          <li><i>The log files should be your first stop for troubleshooting Tomcat and TDS issues.</i> (Hint, hint.)</li>
          <li>Logs files may contain useful information for assessing the security of your system.</li>
          <li>You will become very familiar with the Tomcat-generated <code><small>catalina.out</small></code> and <code><small>localhost_access_log.yyyy-mm-dd.log</small></code> files by the end of this workshop.</li>
         </ul>


      </ol>
     </div> <!-- end subsection -->


   </div> <!-- end Tomcat Directory Structure: Quick Tour section -->





   <div id="section">
    <h2><a name="running">Running Tomcat</a></h2>


     <div id="subsection">
      <h3>Starting &amp; stopping Tomcat</h3>
      <ol>
       <li>Tomcat isn't currently running so we need to start it up.</li>
        <p>Run the <code><small>startup.sh</small></code> script in the Tomcat <code><small>bin/</small></code> directory:</p>
<pre>
<b>$</b> pwd
/home/tds/GettingStarted/apache-tomcat-6.0.32

<b>$</b> bin/startup.sh
</pre>

       <li>Verify Tomcat is running.</li>
        <p>Look and see if you have a Tomcat process running:</p>

<pre>
<b>$</b> ps -ef | grep tomcat
tds      27049     1  2 17:50 pts/1    00:00:02 /usr/bin/java -Djava.util.logging.config.file=/home/tds/GettingStarted/apache-tomcat-6.0.32/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.endorsed.dirs=/home/tds/GettingStarted/apache-tomcat-6.0.32/endorsed -classpath /home/tds/GettingStarted/apache-tomcat-6.0.32/bin/bootstrap.jar -Dcatalina.base=/home/tds/GettingStarted/apache-tomcat-6.0.32 -Dcatalina.home=/home/tds/GettingStarted/apache-tomcat-6.0.32 -Djava.io.tmpdir=/home/tds/GettingStarted/apache-tomcat-6.0.32/temp org.apache.catalina.startup.Bootstrap start
</pre>

        <p>Open a new browser window/tab and go to <a href="http://localhost:8080/">http://localhost:8080/</a> to verify Tomcat is running:</p>

     <p><a href="../../images/congrat.png" target="_blank"><img src="../../images/congrat.png" width="400" height="415" alt="Tomcat Default Home Page" /></a></p>

      <div id="expanded" class="question">
       <p> Which Java is Tomcat currently using?  (Hint:  what was sent to <code><small>STDOUT</small></code> when running the <code><small>startup.sh</small></code> and <code><small>shutdown.sh</small></code>?)</p>
      </div>
       <li>See if you can shutdown Tomcat.</li>
        <p>Run the <code><small>shutdown.sh</small></code> script in the Tomcat <code><small>bin/</small></code> directory:</p>
<pre>
<b>$</b> bin/shutdown.sh
</pre>
      </ol>

      <div id="expanded" class="question">
       <p> Which Java is Tomcat currently using?  (Hint:  what was sent to <code><small>STDOUT</small></code> when running the <code><small>startup.sh</small></code> and <code><small>shutdown.sh</small></code>?)</p>
      </div>

      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting tips</h4>
       <ul>
        <li>Check the logs mostly recently generated in the Tomcat <code><small>logs</small></code> for clues about why Tomcat failed to start or stop.</li>
        <li>Pay particular attention to what is being reported in Tomcat's main log file: <code><small>catalina.out</small></code>.</li>
       </ul>
      </div>


     </div> <!-- end subsection -->




     <div id="subsection">
      <h3>Setting <code>$JAVA_HOME</code>, <code>$JAVA_OPTS</code> and <code>$CATALINA_HOME</code></h3>


       <p>We are going to create a file called <code><small>setenv.sh</small></code> in the Tomcat <code><small>bin/</small></code> directory to:</p>
      <ul class="little">
       <li>allow Tomcat to reference/find the location of <code><small>$JAVA_HOME</small></code>  and <code><small>$CATALINA_HOME</small></code>) during startup and shutdown; and </li>
       <li>increase the amount of memory allocated to the JVM to enhance performance by setting <code><small>$JAVA_OPTS</small>.</code> 
      </ul>

      <div id="expanded" class="question">
       <p>Why are we setting <code><small>$JAVA_HOME</small></code> and <code><small>$CATALINA_HOME</small></code> if we already have set them in our environment? </p>
      </div>



      <ol>
       <li><a name="makeSetenv"></a>Create the <code>setenv.sh</code> file.</li>
        <p>Using your favorite text editor (gedit, vi, emacs, etc.), create a new file called <code><small>setenv.sh</small></code> in the Tomcat <code><small>bin/</small></code> directory:</p>

<pre>
<b>$</b> pwd
/home/tds/GettingStarted/apache-tomcat-6.0.32

<b>$</b> cd bin
<b>$</b> vi setenv.sh
</pre>

        <p>Add the following information and save your <code><small>setenv.sh</small></code> file:</p>
<pre>
#!/bin/sh
#
# ENVARS for Tomcat and TDS environment
#
JAVA_HOME="/home/tds/GettingStarted/jdk1.6.0_26"
export JAVA_HOME

JAVA_OPTS="-Xmx4096m -Xms512m -server -Djava.awt.headless=true -Djava.util.prefs.systemRoot=$CATALINA_HOME/content/thredds/javaUtilPrefs"
export JAVA_OPTS

CATALINA_HOME="/home/tds/GettingStarted/apache-tomcat-6.0.32"
export CATALINA_HOME
</pre>

      <div id="note" class="info">
       <h4>Settings </h4>
       <p>Whenever possible, Unidata recommends <code><small>-Xmx1500m</small></code> for 32-bit systems, and<code><small>-Xmx4096m</small></code> (or more) for 64-bit systems.</p>
      </div> 




        <p>The parameters we pass to <code><small>$JAVA_OPTS</small></code>:</p>


        <ul class="little">
         <li><code><small>-Xms</small></code> is the initial allocated memory of the JVM (for performance).</li>
         <li><code><small>-Xmx</small></code> the maximum allocated memory of the JVM (for performance).</li>
         <li><code><small>-server</small></code> tells the Hostspot compiler to run the JVM in "server" mode.</li>
         <li><code><small>-Djava.awt.headless=true</small></code> is needed to prevent graphics rendering code from assuming a graphics console exists. Without this, WMS code will crash the server in some circumstances.</li>
          <li><code><small>-Djava.util.prefs.systemRoot=$CATALINA_HOME/content/thredds/javaUtilPrefs</small></code> allows the <a href="/projects/THREDDS/tech/tds4.2/faq.html#javaUtilPrefs">java.util.prefs</a> of the TDS WMS service to write system preferences to a location that is writable by the user that Tomcat runs under</li>.
        </ul>
 
       <li>Restart Tomcat to implement your changes.</li>
        <p>Restart Tomcat and examine the output generated to the terminal window by the startup script:</p>
<pre>
<b>$</b> ./startup.sh
Using CATALINA_BASE:   /home/tds/GettingStarted/apache-tomcat-6.0.32
Using CATALINA_HOME:   /home/tds/GettingStarted/apache-tomcat-6.0.32
Using CATALINA_TMPDIR: /home/tds/GettingStarted/apache-tomcat-6.0.32/temp
Using JRE_HOME:        /home/tds/GettingStarted/jdk1.6.0_26
Using CLASSPATH:       /home/tds/GettingStarted/apache-tomcat-6.0.32/bin/bootstrap.jar
</pre>
      <div id="expanded" class="question">
       <p>Did you notice any difference in the what is being reported to <code><small>STDOUT</small></code> during startup?</p>
      </div>
  
        <p>Take a look at the running Tomcat process to see the new <code><small>$JAVA_OPTS</small></code> settings:</p>

<pre>
<b>$</b> ps -ef | grep tomcat
tds       2697     1  7 17:59 pts/1    00:00:03 /home/tds/GettingStarted/jdk1.6.0_26/bin/java -Djava.util.logging.config.file=/home/tds/GettingStarted/apache-tomcat-6.0.32/conf/logging.properties <b>-Xmx1500m -Xms512m -server -Djava.awt.headless=true</b> -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.endorsed.dirs=/home/tds/GettingStarted/apache-tomcat-6.0.32/endorsed -classpath /home/tds/GettingStarted/apache-tomcat-6.0.32/bin/bootstrap.jar -Dcatalina.base=/home/tds/GettingStarted/apache-tomcat-6.0.32 -Dcatalina.home=/home/tds/GettingStarted/apache-tomcat-6.0.32 -Djava.io.tmpdir=/home/tds/GettingStarted/apache-tomcat-6.0.32/temp org.apache.catalina.startup.Bootstrap start
</pre>

      <div id="expanded" class="question">
       <p>What allows us to create the <code><small>setenv.sh</small></code> file and have its contents read?   (Hint: have a look at the <code><small>catalina.sh</small></code> file in the Tomcat <code><small>bin/</small></code> directory starting around line 117).</p>
      </div>

      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting tips</h4>
       <ul>
        <li>Do not forget include the '<code><small>m</small></code>' in your <code><small>-Xms</small></code>  and <code><small>-Xmx</small></code>  settings.</li>
        <li>You may have allocated too much memory for the JVM settings if Tomcat fails to start and you get the following error reported in the Tomcat log <code><small>catalina.out</small></code>:</li>
<pre>
Error occurred during initialization of VM
Could not reserve enough space for object heap
</pre>
        <li>Likewise, if  there is an error with your JVM memory allocation syntax in the <code><small>setenv.sh</small></code> file, it will be reported to <code><small>catalina.out</small></code>:</li>
<pre>
Error occurred during initialization of VM
Incompatible minimum and maximum heap sizes specified
</pre>
       </ul>
      </div>
      </ol>
     </div> <!-- end subsection -->




      <div id="subsection" class="exercise">
       <h3>Exercise Two: Set <code>$JAVA_HOME</code>, <code>$JAVA_OPTS</code> and <code>$CATALINA_HOME</code></h3>
       <ol>
        <li>Create a <code>setenv.sh</code> file in the Tomcat <code>bin/</code> and set <code>$JAVA_HOME</code>, <code>$JAVA_OPTS</code> and <code>$CATALINA_HOME</code>.</li>

       </ol>
      </div>


   </div> <!-- end Running Tomcat section -->





   <div id="section">
    <h2><a name="deploying">Deploying the TDS</a></h2>

     <div id="subsection">
      <h3>About WAR files</h3>
       <ul>
        <li>WAR is short for <b>W</b>eb <b>AR</b>chive.</li>
        <li>By default, Tomcat will automatically unpack the WAR distribution into directory of the same name upon deployment.</li>
        <li>Note: the unpacked directory is overwritten each time a new WAR file is deployed.</li>
        </ul>
     </div> <!-- end subsection -->


     <div id="subsection">
      <h3>Downloading &amp; deploying <code>thredds.war</code></h3>

      <div id="note" class="info">
       <h4>Upgrading the TDS</h4>
       <p>The <a href="http://www.unidata.ucar.edu/projects/THREDDS/tech/tds4.2/reference/index.html">reference</a> documentation contains information on <a href="http://www.unidata.ucar.edu/projects/THREDDS/tech/tds4.2/UpgradingTo4.2.html">upgrading</a> the TDS. </p>
      </div>

      <ol>
       <li><a href="http://www.unidata.ucar.edu/downloads/thredds/index.jsp">Download</a> the TDS WAR file from Unidata's web site.</li>
        <p>We will be using the current <i>TDS 4.2 (stable) version</i> for this workshop:</p>
        <p><code>thredds.war</code></p>
       <li>Deploy the TDS in Tomcat.</li>
        <p>Put <code><small>thredds.war</small></code> in the Tomcat <code><small>webapps/</small></code> directory:</p>

<pre>
<b>$</b> pwd
/home/tds/GettingStarted/apache-tomcat-6.0.32/bin
<b>$</b> cd ../webapps

<b>$</b> cp ~/Downloads/thredds.war .
<b>$</b> ls -l
total 24612
drwxr-xr-x 10 tds Unidata     4096 Jul 11 17:47 docs
drwxr-xr-x  5 tds Unidata     4096 Jul 11 17:47 examples
drwxr-xr-x  5 tds Unidata     4096 Jul 11 17:47 host-manager
drwxr-xr-x  5 tds Unidata     4096 Jul 11 17:47 manager
drwxr-xr-x  3 tds Unidata     4096 Jul 11 17:47 ROOT
-rw-r--r--  1 tds Unidata 25238961 Jul 11 18:02 thredds.war
</pre>

       <li>Confirm the TDS has been deployed.</li>
        <p>If Tomcat is already running, wait a couple of seconds after placing the WAR file in the Tomcat <code><small>webapps/</small></code> and then verify the <code><small>thredds.war</small></code> file was unpacked:</p>

<pre>
<b>$</b> ls -l
total 24616
drwxr-xr-x 10 tds Unidata     4096 Jul 11 17:47 docs
drwxr-xr-x  5 tds Unidata     4096 Jul 11 17:47 examples
drwxr-xr-x  5 tds Unidata     4096 Jul 11 17:47 host-manager
drwxr-xr-x  5 tds Unidata     4096 Jul 11 17:47 manager
drwxr-xr-x  3 tds Unidata     4096 Jul 11 17:47 ROOT
drwxr-xr-x  6 tds Unidata     4096 Jul 11 18:02 thredds
-rw-r--r--  1 tds Unidata 25238961 Jul 11 18:02 thredds.war
</pre>

</pre>

 <p>Go to <a href="http://localhost:8080/thredds/">http://localhost:8080/thredds/</a> in your browser to verify the TDS has been deployed:</p>

     <p><a href="../../images/tds.png" target="_blank"><img src="../../images/tds.png" width="400" width="433" alt="THREDDS Distribution Catalog" /></a></p>

      </ol>
      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting tips</h4>
       <ul>
        <li>Any error in the TDS deployment will be reported in the <code><small>catalina.out</small></code> file of the Tomcat  <code><small>logs/</small></code> directory. </li>
        <li>Be sure you have downloaded and deployed the TDS 4.2 (stable) version for this workshop (the version number will appear in the blue bar at the bottom of TDS catalog pages).</li>
       </ul>
      </div>

     </div> <!-- end subsection -->



      <div id="subsection" class="exercise">
       <h3>Exercise Three: Deploy your own instance of the THREDDS Data Server</h3>
       <ol>
        <li>Deploy the TDS in your newly-installed Tomcat.</li>
        <li>Once deployed, browse the test catalogs & datasets that come with the distribution.</li>
        <li>Look at the directory contents of the main Tomcat directory <code><small>~/GettingStarted/apache-tomcat-6.0.32</small></code> (aka <code><small>$TOMCAT_HOME</small></code>).</li>
         <div class="exercise_question">
          <p>Do you notice anything new?</p>
         </div>
       </ol>
      </div>



   </div> <!-- end Deploying the TDS section -->

 
   <div id="section">

    <h2><a name="logs">Tomcat Log Files</a></h2>


     <div id="subsection">
      <h3>Tomcat <code>logs/</code></h3>
      
      <ol>
       <li>Look at the different types of log files being generated in the Tomcat <code>logs/</code> directory.</li>
        <p>Move into the <code><small>logs/</small></code> directory to see the type of information being logged:</p>

<pre>
<b>$</b> pwd
/home/tds/GettingStarted/apache-tomcat-6.0.32/webapps
<b>$</b> cd ../logs

<b>$</b> ls -l
total 20
-rw-r--r-- 1 tds Unidata 4423 Jul 11 18:02 catalina.2011-07-11.log
-rw-r--r-- 1 tds Unidata 4741 Jul 11 18:02 catalina.out
-rw-r--r-- 1 tds Unidata    0 Jul 11 17:50 host-manager.2011-07-11.log
-rw-r--r-- 1 tds Unidata 2132 Jul 11 18:02 localhost.2011-07-11.log
-rw-r--r-- 1 tds Unidata    0 Jul 11 17:50 manager.2011-07-11.log
</pre>

      <div id="expanded" class="question">
       <p>Do you see a correspondence between some of the web applications in the Tomcat <code><small>webapps/</small></code> directory and the naming of certain log files?</p>
      </div>
      <div id="expanded" class="question">
       <p>Is there a difference in the information being logged to <code><small>catalina.out</small></code> versus <code><small>catalina.yyyy-mm-dd.log</small></code>?</p>
      </div>
      <div id="expanded" class="question">
       <p>Are some log files more verbose than others?</p>
      </div>

       <li>Examining <code>catalina.out</code>.</li>
        <p>Open another terminal window (hereafter referred to as terminal #2) and run the following command in the new terminal:</p>
<pre>
<b>$</b> tail -f /home/tds/GettingStarted/apache-tomcat-6.0.32/logs/catalina.out
</pre>
<p>In your original terminal window, start/stop and start Tomcat and watch what is being logged to <code>catalina.out</code> in the terminal #2 window.</p>
      <div id="expanded" class="question">
       <p>Is it only errors messages being reported to <code><small>catalina.out?</small></code></p>
      </div>
      <div id="expanded" class="question">
       <p>What messages in <code><small>catalina.out</small></code> are from the TDS?</p>
      </div>
      </ol>
     </div> <!-- end subsection -->



     <div id="subsection">
      <h3>Things to know about <code>catalina.out</code></h3>

      <div id="note" class="info">
       <h4><code>catalina.out</code></h4>
       <p>The <a href="http://marc.info/?l=tomcat-user&w=2&r=1&s=catalina.out+rotate&q=b">Tomcat Users mailing list</a> has seen a lot of traffic dedicated to <code><small>catalina.out</small></code> logging and rotation.</p>
      </div>


       <ul>
        <li>Tomcat <code><small>System.out</small></code> and <code><small>System.err</small></code> gets appended to <code><small>catalina.out</small></code>.  </li>
        <li><code><small>catalina.out</small></code> can quickly grow large if the hosted web applications are not specifically catching and logging <code><small>System.out</small></code> and <code><small>System.err</small></code> to designated files.</li>
        <li><code><small>catalina.out</small></code> is not automatically rotated in Tomcat.</li>
        <li>You should employ an outside log rotation program (e.g., <code><small>logadm</small></code> or <code><small>logrotate</small></code>) to rotate <code><small>catalina.out</small></code>.</li>
        <li>It is good practice to archive and remove old <code><small>catalina.out</small></code> files and other log files out of the Tomcat <code><small>logs/</small></code> on a regular basis.</li>
        </ul>
     </div> <!-- end subsection -->

   </div> <!-- end A Cursory Look at Log Files section -->


   <div id="section">
    <h2><a name="files">Tomcat (Server-Level) Configuration Files</a></h2>

     <div id="subsection">
      <h3>About <code>server.xml</code> </h3>

      <div id="note" class="reminder">
       <h4>Keep in mind</h4>
       <p>Tomcat's configuration files, including  <code><small>server.xml</small></code> can be found in in the Tomcat <code><small>conf/</small></code> directory.</p>
      </div>
      <ul>
       <li>XML file (well-formed syntax is important).</li>
       <li>Tomcat's main configuration file.</li>
       <li>Changes to <code><small>server.xml</small></code> do not take effect until Tomcat is restarted.</li>
       <li>Where we make changes to enhance TDS security.</li>

      </ul>
     </div> <!-- end  subsection -->




     <div id="subsection">
      <h3>Important elements in <code>server.xml</code></h3>
       <ol>
        <li>Examine the Elements in <code>server.xml</code>.</li>
         <p>Move into the Tomcat <code><small>conf/</small></code> directory and examine the <code><small>server.xml</small></code> file:</p>
<pre>
<b>$</b> pwd
/home/tds/GettingStarted/apache-tomcat-6.0.32/logs
<b>$</b> cd ../conf

<b>$</b> less server.xml
</pre>  


         <p>Reference the table below to see how the <code><small>server.xml</small></code> elements relate to configuring TDS (mouse-over the element for a description):</p>
          <table>
           <tr>
            <th>  
             Tag Name
            </th>
            <th> 
             Instances
            </th> 
            <th> 
             How it relates to the TDS
            </th>
           </tr>

           <tr>
            <td> 
              <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/config/server.html"><code>&lt;Server&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>Server</code> element represents the entire Catalina servlet container as a whole. It is the single outermost element in <code>server.xml</code></b></a>
            </td>
            <td>   
              1...1
            </td> 
            <td> 
               Not modified unless you want to change the port number Tomcat listens for a SHUTDOWN command. (Enabled by default.)
            </td>
           </tr>

           <tr>
            <td style="padding-left: 20px"> 
              <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/config/globalresources.html"><code>&lt;GlobalNamingResources&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>GlobalNamingResources</code> element defines the global Java Naming and Directory Interface (JNDI) resources for the Server.</b></a>
            </td>
            <td>   
             0...*
            </td> 
            <td> 
             Needed to contain the <code>UserDatabase</code> that corresponds to the <code>UserDatabaseRealm</code> used to authenticate users. (Enabled by default.)

            </td>
           </tr>

           <tr>
            <td style="padding-left: 40px">  
              <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/config/resources.html"><code>&lt;Resource&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>Resource</code> element represents a static resource from which classes will be loaded and static files will be served.</b></a>
            </td>
            <td>   
             0...*
            </td> 
            <td> 
             Editable user database (<code>tomcat-users.xml</code>) used by <code>UserDatabaseRealm</code> to authenticate users. (<code>UserDatabaseRealm Resource</code> enabled by default.)
            </td>
           </tr>

           <tr>
            <td style="padding-left: 20px"> 
              <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/config/service.html"><code>&lt;Service&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>Service</code> element represents the combination of one or more <code>Connector</code> components that share a single Engine component for processing incoming requests. The top Tomcat <code>service</code> is named <code>Catalina</code> (hence the log file name of <code>catalina.out</code>).</b></a>
            </td>
            <td>   
             1...*
            </td> 
            <td> 
              Not modified unless you wish to establish more than one service. (<code>Catalina Service</code> enabled by default.)
            </td>
           </tr>

           <tr>
            <td style="padding-left: 40px">  
              <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/connectors.html"><code>&lt;Connector&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>Connector</code> element forward requests to the <code>Engine</code> using a specific protocol and returns the results to the requesting client. </b></a>
            </td>
            <td>   
             1...*
            </td> 
            <td> 
             Used to establish HTTP and SSL connections.  Also will communicate with an web server for proxying requests. (HTTP connector enabled by default on port 8080.)
            </td>
           </tr>

           <tr>
            <td style="padding-left: 40px">  
             <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/config/engine.html"><code>&lt;Engine&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>Engine</code> element represents the entire request processing machinery associated with a particular Catalina <code>Service</code>.</b></a>
            </td>
            <td>   
             1...1
            </td> 
            <td> 
             Not modified unless you specify a <code>Host</code> other than <code>localhost</code>. (Enabled by default.)
            </td>
           </tr>

           <tr>
            <td style="padding-left: 60px">  
              <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/config/realm.html"><code>&lt;Realm&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>Realm</code> element represents a "database" of usernames, passwords, and roles (groups) assigned to those users. </b></a>
            </td>
            <td>   
             0...*
            </td> 
            <td> 
             The <code>UserDatabaseRealm</code> uses the <code>UserDatabase</code> configured in the global JNDI <code>Resource</code>. (<code>UserDatabaseRealm</code> enabled by default.)
            </td>
           </tr>


           <tr>
            <td style="padding-left: 60px">  
             <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/config/valve.html"><code>&lt;Valve&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>Valve</code> element represents a component that will be inserted into the request processing pipeline for the associated containing element.</b></a>
            </td>
            <td>   
             0...*
            </td> 
            <td> 
             The <code>RemoteAddrValve</code> is used to filter access to the TDS based on IP address.  (NOT enabled by default.  You will need to add this if you want to use IP Filtering.)
            </td>
           </tr>
           <tr>
            <td style="padding-left: 60px">  
             <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/config/host.html"><code>&lt;Host&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>Host</code> element represents a virtual host.</b></a>
            </td>
            <td>   
             1...*
            </td> 
            <td> 
             Not modified unless you specify a <code>Host</code> other than <code>localhost</code>. (<code>localhost</code> enabled by default.)
            </td>
           </tr>
           <tr>
            <td style="padding-left: 80px">  
             <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/config/realm.html"><code>&lt;Realm&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>Realm</code> element represents a "database" of usernames, passwords, and roles (groups) assigned to those users. </b></a>
            </td>
            <td>   
             0...*
            </td> 
            <td> 
             We use the <code>MemoryRealm</code> to configuring Tomcat to use digested passwords. (NOT enabled by default.  You will need to add this if you want to use digested passwords.)
            </td>
           </tr>
           <tr>
            <td style="padding-left: 80px">  
             <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/config/valve.html"><code>&lt;Valve&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>Valve</code> element represents a component that will be inserted into the request processing pipeline for the associated containing element.</b></a>
            </td>
            <td>   
             0...*
            </td> 
            <td> 
             We modify the <code>AccessLogValve</code> to customize the access logs generated by Tomcat. (NOT enabled by default.  You will need to add this if you want to enable access logging.)
            </td>
           </tr>
          </table>
      </ol>
     </div> <!-- end server.xml Elements subsection -->


     <div id="subsection">
      <h3>About <code>tomcat-users.xml</code> </h3>
      <ul>
       <li>XML file (well-formed syntax is important).</li>
       <li>Stores user names, passwords and roles.</li>
       <li>Changes to <code>tomcat-users.xml</code> do not take effect until Tomcat is restarted.</li>
       <li>What the TDS uses for user authentication and access control.</li>
      </ul>
     </div> <!-- end  subsection -->




     <div id="subsection">
      <h3>Important elements in <code>tomcat-users.xml</code></h3>
       <ol>
        <li>Examine the Elements in <code>tomcat-users.xml</code>.</li>
         <p>Open the <code><small>tomcat-users.xml</small></code> file:</p>
<pre>
<b>$</b> pwd
/home/tds/GettingStarted/apache-tomcat-6.0.32/conf

<b>$</b> less tomcat-users.xml
</pre>  

         <p>Reference the table below to see how the <code><small>tomcat-users.xml</small></code> elements relate to configuring TDS (mouse-over the element for a description):</p>
          <table>
           <tr>
            <th>  
             Tag Name
            </th>
            <th> 
             Instances
            </th> 
            <th> 
             How it relates to the TDS
            </th>
           </tr>

           <tr>
            <td> 
             <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><code>&lt;tomcat-users&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>tomcat-users</code> element represents the single outermost element in <code>tomcat-users.xml</code></b>
            </td>
            <td>   
             1...1
            </td> 
            <td> 
             Not modified.  (The only tag you get by default.)
            </td>
           </tr>

           <tr>
            <td style="padding-left: 20px"> 
             <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><code>&lt;role&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>role</code> element defines one role or group a user can belong to.</b>
            </td>
            <td>   
             1...*
            </td> 
            <td> 
             You will have at least two of these: one for the Tomcat <code>manager</code> application and one for the TDS. (You will need to add if you want to enable role-based authentication.)
            </td>
           </tr>

           <tr>
            <td style="padding-left: 20px"> 
             <a class="tooltip" href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><code>&lt;user&gt;</code><b><em class="outer"></em><em class="inner"></em><big>Description:</big> The <code>user</code> element represents one valid user.</b>
            </td>
            <td>   
             1...*
            </td> 
            <td> 
             You will need to create an entry for each user who needs access to the Tomcat <code>manager</code> application and/or the restricted areas of the TDS.  (You will need to add if you want to enable user authentication.)
            </td>
           </tr>   
          </table>
       </ol>
      </div> <!-- end subsection -->




   </div> <!-- end Tomcat Configuration Files section -->






   <div id="section">
    <h2><a name="manager">Tomcat <code>manager</code> Application</a></h2>


     <div id="subsection">
      <h3>About the <code>manager</code> application</h3>
      <div id="note" class="info">
       <h4>More about <code>manager</code></h4>
       <p>For more information about the Tomcat <code><small>manager</small></code> application, see the Tomcat <a href="http://tomcat.apache.org/tomcat-6.0-doc/manager-howto.html">Manager App HOW-TO</a> documentation.</p>
      </div>



      <ul>
       <li>"Free" web application that comes with Tomcat distribution.</li>
       <li>Lives in the <code>manager</code> directory in the Tomcat <code>webapps/</code> directory. </li>
       <li>Allows Tomcat administrators to deploy, undeploy, or reload web applications such as the TDS without having to shut down and restart Tomcat.</li>
       <li>Provides server status statistics for the JVM and each connector you have configured in <code>server.xml</code>.</li>
      </ul>

     </div> <!-- end subsection -->


     <div id="subsection">
      <h3>Accessing the Tomcat <code>manager</code> application</h3>

      <div id="note" class="info">
       <h4>Changes to the <code>manager</code> application</h4>
       <p>The <code><small>manager</small></code> application URLs and roles has been re-structured. See the Tomcat <a href="http://tomcat.apache.org/migration.html">Migration guide</a> for more information.</p>
      </div>
      <p>Attempt to access the Tomcat <code><small>manager</small></code> application in your browser: <a href="http://localhost:8080/manager/html/">http://localhost:8080/manager/html/</a>. You will be prompted to login via BASIC authentication, which will end in failure since we do not yet have permission to access the <code><small>manager</small></code> application:</p>

        <p><a href="../../images/manager401.png" target="_blank"><img src="../../images/manager401.png" width="400"  alt="Manager app with 401 response code"></a></p>

      <div id="expanded" class="question">
       <p>Based on what we know about Tomcat configuration, which file in the Tomcat <code><small>conf/</small></code> directory should we edit to grant ourselves access to the <code><small>manager</small></code> application?</p>
      </div>

     </div> <!-- end subsection -->




     <div id="subsection">
      <h3>Granting access to the <code>manager</code> application</h3>

       <ol>
        <li>Modify <code>tomcat-users.xml</code> to add <code>role</code> and <code>user</code> elements.</li>
         <p>Using your favorite editor, open <code><small>$TOMCAT_HOME/conf/tomcat-users.xml</small></code>:</p>
<pre>
<b>$</b> vi tomcat-users.xml
</pre>   
        <p>Between the <code><small>&lt;tomcat-users&gt;</small></code> tags, add a <code><small>role</small></code> element and specify the <code><small>rolename</small></code> attribute as <code><small>manager</small></code>:</p>
          
<pre>
&lt;tomcat-users&gt;
    &lt;role rolename="manager-gui"/&gt;
&lt;/tomcat-users&gt;
</pre>  
          <p>Now add a new user by adding a <code><small>user</small></code> element. Create a <code><small>username</small></code> and <code><small>password</small></code> for the new user and specify <code><small>manager-gui</small></code> as one of the <code><small>roles</small></code> (in this example we are creating a user called 'admin' with a corresponding password of 'secret'):</p>
<pre>
&lt;tomcat-users&gt;
    &lt;role rolename="manager-gui"/&gt;
    &lt;user username="admin" password="secret" roles="manager-gui"/&gt;   
&lt;/tomcat-users&gt;
</pre>  
        <li>Restart Tomcat and log into the <code>manager</code> application.</li>

      <div id="note" class="reminder">
       <h4>Keep in mind</h4>
       <p>Changes to <code><small>tomcat-users.xml</small></code> do not take effect until Tomcat is restarted.</p>
      </div>

           <p>Attempt to access the <code><small>manager</small></code> application again (<a href="http://localhost:8080/manager/html/">http://localhost:8080/manager/html/</a>), this time logging in using the <code><small>name</small></code> and <code><small>password</small></code> specified in <code><small>tomcat-users.xml</small></code>:  </p>

         <p><a href="../../images/manager.png" target="_blank"><img src="../../images/manager.png" width="400" height="433" alt="Tomcat manager application"></a></p>

      <div id="note" class="ahead">
       <h4>Thinking ahead</h4>
       <p>To gain access to restricted parts of the TDS, you will perform the same steps you used to grant yourself access to the <code><small>manager</small></code> application.</p>
      </div>


         <p>Voil&#224;!  You should have access to the <code>manager</code> application.</p>
          
       </ol>

      <div id="expanded" class="troubleshooting">
       <h4>Troubleshooting tips</h4>
       <ul>
        <li>Check the XML syntax in <code><small>tomcat-users.xml</small></code> to make sure it is well-formed and without error.</li>
        <li>Did you restart Tomcat after you made your changes to <code><small>tomcat-users.xml</small></code>?</li>
        <li>Any errors will be reported in the Tomcat <code><small>logs/catalina.out</small></code> file. </li>
       </ul>
      </div>
     </div> <!-- end subsection -->



      <div id="subsection" class="exercise">
       <h3>Exercise Four: Grant yourself access to the Tomcat <code>manager</code> application</h3>
       <ol>
        <li>Using the steps outlined above, modify <code>tomcat-users.xml</code> to grant yourself access to the Tomcat <code>manager</code> application.</li>
       </ol>
      </div>



     <div id="subsection">
      <h3>Deploying the TDS using the <code>manager</code> application</h3>
      <ol>
       <li>Use the <code>manager</code> application to undeploy the TDS.</li>          
        <p>Find the TDS in the list of web application on the <code><small>Applications</small></code> page.  <b>Stop</b> and then <b>Undeploy</b> the TDS:</p>
        <p><img src="../../images/undeploy.gif" height="92" width="754" alt="Undeploy the TDS"></p>
        <p>List the contents of the Tomcat <code><small>webapps/</small></code> directory to verify that both <code><small>thredds.war</small></code> and the unpacked <code><small>thredds/</small></code> directory have been removed:</p>
<pre>
<b>$</b> pwd
/home/tds/GettingStarted/apache-tomcat-6.0.32/conf
<b>$</b> cd ../webapps

<b>$</b> ls -l
total 20
drwxr-xr-x 10 tds Unidata 4096 Jul 11 17:47 docs
drwxr-xr-x  5 tds Unidata 4096 Jul 11 17:47 examples
drwxr-xr-x  5 tds Unidata 4096 Jul 11 17:47 host-manager
drwxr-xr-x  5 tds Unidata 4096 Jul 11 17:47 manager
drwxr-xr-x  3 tds Unidata 4096 Jul 11 17:47 ROOT
</pre>
       <li>Deploy the TDS using the <code>manager</code> application.</li>
       <p>Upload the TDS WAR file using the <code><small>Deploy</small></code> section of the <code><small>manager</small></code> application:</p>
        <p><a href="../../images/deploy.png" target="_blank"><img src="../../images/deploy.png" height="182" width="500" alt="Deploy the TDS"></a></p>
       <p>Confirm the deployment went as planned by accessing the TDS using your browser: <a href="http://localhost:8080/thredds/">http://localhost:8080/thredds/</a></p>
       </ol>
     </div> <!-- end subsection -->




      <div id="subsection" class="exercise">
       <h3>Exercise Five: Deploy the THREDDS Data Server using the <code>manager</code> application</h3>
       <ol>
        <li>Using the steps outlined above, deploy the TDS using the <code>manager</code> application.</li>
       </ol>
      </div>


     <div id="subsection">
      <h3>Caveat of the <code>manager</code> application</h3>


      <div id="note" class="info">
       <h4><code>PermGen</code> info</h4>
       <p>For a really good description of the issue, see this series of three articles:</p>
           <ul>
             <li>"<a href="http://my.opera.com/karmazilla/blog/2007/09/29/return-of-the-permgen">Return of the PermGen</a>" (2007-09-29)</li>
             <li>"<a href="http://my.opera.com/karmazilla/blog/2007/03/15/permgen-strikes-back">PermGen Strikes Back</a>" (2007-03-15)</li>
             <li>"<a href="http://my.opera.com/karmazilla/blog/2007/03/13/good-riddance-permgen-outofmemoryerror">Good Riddance PermGen OutOfMemoryError</a>" (2007-03-13)</li>
           </ul>
      </div>

      <p>The dreaded <code><small>java.lang.OutOfMemoryError: PermGen space failure</small></code> error:</p>
      <ul>
        <li><b>The issue: </b> The "PermGen" error happens when the JVM runs out of memory in the permanent generation. (Default PermGen size differs among Sun JDK versions, but the upper limit is typically 64MB.)</li>
        <li><b>The cause: </b> Objects in the permanent generation are never garbage collected.  When redeploying your web application using the Tomcat <code><small>manager</small></code>  application, your WAR file is unpacked and parts of the class file definition are loaded into PermGen space, like string constants.</li>
        <li><b>The symptom:</b> The PermGen error will manifest itself in a sluggish Tomcat <code><small>manager</small></code>  application that never completes a task, and the <code><small>java.lang.OutOfMemoryError: PermGen space failure</small></code>  error being displayed in <code><small>$TOMCAT_HOME/logs/catalina.out</small></code> </li>
         <li><b>A temporary fix:</b> You can add the <code><small>-XX:MaxPermSize</small></code>  switch to <code><small>$JAVA_OPTS</small></code>  to increase the amount of memory allocated for the permanent generation,  However this is only postponed the inevitable, as even an increased memory in permanent generation will eventually fill up.  When this happens, you will need to stop/start Tomcat at this point. For this reason, you may want to restart Tomcat whenever you redeploy TDS or another webapp.</li>
       </ul>

     </div> <!-- end subsection -->


   </div> <!-- end Tomcat manager Application section -->






   <div id="section">
    <h2><a name="next">Next Steps: Where To Go From Here</a></h2>
     <div id="subsection">
      <h3>You're not finished yet</h3>




      <div id="note" class="ahead">
       <h4>TDS remote management tool</h4>
       <p>You will need to enable <a href="Security.html#ssl">Enable SSL encryption</a> to access TDS remote management tool.</p>
          
      </div>

      <ul>
       <li>We <i>highly recommend</i> you follow the best practices outlined in the <a href="Security.html">Tomcat and TDS Security Considerations</a> section of the tutorial to finish hardening your server environment.</li>
       <li>The <a href="BasicConfig.html">Basic TDS Configuration</a> and <a href="ConfigCatalogs.html">TDS Configuration Catalogs</a> sections of this tutorial covers the TDS configuration files, configuration options and TDS catalog structure.</li>
       <li>Additional sections of the tutorial cover how to enable <a href="AddingServices.html">OGC/ISO Services</a>, and <a href="/software/netcdf/ncml/v2.2/Tutorial.html">Using NcML in TDS</a>.</li>
      </ul>

     </div> <!-- end subsection -->



   </div> <!-- end Tomcat manager Application section -->







   <p><img src="../../images/thread.png" height="60" alt="THREDDS" valign="top" align="left" vspace="0" hspace="10" />  This document is maintained by Unidata.  Send comments to <a href="mailto:support-thredds@unidata.ucar.edu">THREDDS support</a>.</p>

   



  </body>
 </html>   
