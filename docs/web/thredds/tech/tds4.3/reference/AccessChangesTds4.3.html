<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Accessing TDS 4.3 and the new GRIB FeatureCollections</title>
<style type="text/css">
pre {font-size: 9pt; padding: 10px; background-color: #E7E7E7; border: 1px solid #CFCFCF; width: 85%;}
code {font-size: 11pt;}
dl {margin: 10px 5px 5px 15px;}
</style>
</head>

<body>
<h1><img src="../../../images/unidataLogo.png" alt="" width="73" height="75" align="absbottom" />Accessing TDS 4.3 and the new GRIB FeatureCollections</h1>
<hr />
<p>Many changes have been made in the way GRIB files are handled in TDS 4.3; these changes will affect all TDS servers running 4.3. While the updates required to access resources on servers running the latest version of TDSS, the new capabilities afforded by version 4.3 make the effort well worth it. To reiterate some of these changes:</p>
<ul>
  <li>The TDS maintainer need only specify a collection of GRIB-1 or GRIB-2 files, and the software turns them into a dataset.</li>
  <li>New indexing scheme allows fast access and scalability to very large datasets.</li>
  <li>Multiple horizontal domains are supported and placed into separate groups.</li>
  <li>Interval time coordinates are fully supported.</li>
  <li>Collection level datasets are automatically created. These correspond to the FMRC <em>best</em> dataset.</li>
  <li>All individual files are also made available.</li>
</ul>
<p>Important notes:</p>
<ul>
  <li>Software that relies on GRIB variable names assigned by the CDM will likely run into issues, as these names have changed.</li>
  <li>The use of motherlode.ucar.edu (including the port variations) to access the Unidata TDS has been deprecated. Please see below for the new access URLs.</li>
  <li>Software that took advantage of FMRC collections on the Unidata TDS (formally known as motherlode.ucar.edu) will need to be updated to use new data access urls.</li>
  <li>The FMRC <em>Forecast Model Run Collection (2D time coordinates)</em>, <em>Forecast Model Run</em>, <em>Constant Forecast Date</em>, and <em>Constant Forecast Offset</em> datasets are no longer available.</li>
</ul>
<hr />

<h2>GRIB Variable name changes:</h3>
<p>The method in which GRIB 1/2 variable names generated by the CDM has change. This is to try to ensure the generation of unique, human readable variable names, without relying on the names contained inside the generally volatile GRIB tables. In order to aid in the transition, we have created a GribVariableRenamer class that will, when possible, return a new, unique GRIB variable name based on the old GRIB name. In some cases, such as mixed interval GRIB variables, a list of potential new variable names are returned. Below is a simple example of how to use the GribVariableRenamer:</p>

<pre>
    import ucar.nc2.dt.grid.GridDataset;
    import ucar.nc2.grib.GribVariableRenamer;
    
    GridDataset gds = ucar.nc2.dt.grid.GridDataset.open("/path/to/file/GFS_CONUS_80km_20100513_0600.grib1");

    GribVariableRenamer r = new GribVariableRenamer();
    List<String> result = r.getMappedNamesGrib1("Precipitable_water");
    // for grib2, use:
    //List<String> result = r.getMappedNamesGrib2("Precipitable_water");
</pre>


<p>If you use the CDM to read GRIB files from the Unidata TDS, then you can supply the GribVariableRenamer with the GridDataset object to increase your chances of obtaining a unique new GRIBVariableName:</p>

<pre>
    import ucar.nc2.dt.grid.GridDataset;
    import ucar.nc2.grib.GribVariableRenamer;
    
    GridDataset gds = ucar.nc2.dt.grid.GridDataset.open("/path/to/file/GFS_CONUS_80km_20100513_0600.grib1");

    GribVariableRenamer r = new GribVariableRenamer();
    List<String> result = r.matchNcepNames(gds, "Precipitable_water");

</pre>

<p>Note that this is setup to work best for the NCEP GRIB 1/2 files served on the Unidata TDS.</p>

<hr />

<h2>Access URL Updates:</h3>

<table width="546" border="1">
  <tr>
    <th width="129" scope="col">Old URL</th>
    <th width="105" scope="col">New URL</th>
  </tr>
  <tr>
    <td>http://motherlode.ucar.edu/thredds/catalog.xml</td>
    <td>http://thredds.ucar.edu/thredds/catalog.xml</td>
  </tr>
  <tr>
    <td>http://motherlode.ucar.edu:8080/thredds/catalog.xml</td>
    <td>http://thredds.ucar.edu/thredds/catalog.xml</td>
  </tr>
  <tr>
    <td>http://motherlode.ucar.edu:8081/thredds/catalog.xml</td>
    <td>http://thredds-test.ucar.edu/thredds/catalog.xml</td>
  </tr>
  <tr>
    <td>http://motherlode.ucar.edu:9080/thredds/catalog.xml</td>
    <td>http://thredds-dev.ucar.edu/thredds/catalog.xml</td>
  </tr>  
</table>
<p>notes:</p>
<ul>
  <li>In general, motherlode.ucar.edu is now thredds.ucar.edu; this server will run the latest stable version of the TDS</li>
  <li>thredds-test.ucar.edu is the Unidata test TDS server, used to host betas, release candidates.</li>
  <li>thredds-dev.ucar.edu is the Unidata development server, and is used to host nightly builds of the latest GIT development branch. </li>
  <li>All varients of the thredds*.ucar.edu urls redirect to thredds*.ucar.edu/thredds/catalog.html</li>
</ul>

<p>Also, the dataset UrlPaths on the Unidata TDS server have changed. While most of these changes are minor (for example, the removal of /frmc/ for /grib/ in the URL to indicate the collection type), not all changes are straight forward (especially for Best Time Series). In order to aid developers, we are providing an <a href="./tdsUrlMaps.xml">xml document</a> that contains a mapping of old urlPaths to newUrl paths. This is the same xml file that the Unidata Integrated Data Viewer is using to help aid users in transition from TDS 4.2 to TDS 4.3.</p>

<hr />

<address>
<img src="../../../images/thread.png" alt="" width="76" height="67" /> This document is maintained by <a href="mailto:caron@unidata.ucar.edu">Sean Arms</a> and was last updated December 2012
</address>
</body>
</html>
