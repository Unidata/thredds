---
title: Log Files Generated by Tomcat
last_updated: 2018-04-02
sidebar: tdsTutorial_sidebar
toc: false
permalink: tomcat_logs.html
---

## Tomcat Logs!

{% include image.html file="tds/tutorial/monitoring_and_debugging/log.png" alt="Log!" caption="" %}

This section covers log files generated by Tomcat and the TDS for the purposes of monitoring and debugging.

You should be familiar with [Tomcat, Java](install_java_tomcat.html), and [TDS](deploying_the_tds.html) installation, as well as basic and advanced TDS configuration.

## Tomcat Access Logs

The access log records all requests processed by the server.
As of Tomcat 7, enabled in Tomcat by default in `${tomcat_home}/conf/server.xml`.
Information it contains is different from other logs in `${tomcat_home}/logs`.
Used for monitoring who is using your server and as a way of obtaining "feedback" about the activity and performance of the server.
In order to use the `TdsMonitor` tool, you will need to change the default configuration of the `AccessLogValve`.

### Configuring Tomcat access logging for the `TdsMonitor`

Modify the `prefix`, `suffix`, and `pattern` attributes of the `AccessLogValve` element.

1. Using your favorite editor open `${tomcat_home}/conf/server.xml`:

   ~~~bash
   $ vi server.xml
   ~~~

   Locate the `AccessLogValve` contained in the `Host` element (should be near the bottom of the file):

   ~~~xml
   <!-- Define the default virtual host
           Note: XML Schema validation will not work with Xerces 2.2.
  -->
   <Host name="localhost"  appBase="webapps"
         unpackWARs="true" autoDeploy="true">

     <!-- SingleSignOn valve, share authentication between web applications
          Documentation at: /docs/config/valve.html -->
     <!--
     <Valve className="org.apache.catalina.authenticator.SingleSignOn" />
     -->

     <!-- Access log processes all example.
       Documentation at: /docs/config/valve.html
       Note: The pattern used is equivalent to using pattern="common" -->
       <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
       prefix="localhost_access_log." suffix=".txt"
       pattern="%h %l %u %t "%r" %s %b" />

   </Host>
   ~~~

   Change the `prefix` and `suffix` attributes to customize the access log name. (The `TdsMonitor` tool looks for log files to begin with "access".)

   ~~~xml
   prefix="access."
   suffix=".log"
   ~~~

   To provide more useful information about who is accessing the TDS, change the pattern element to customize the format of each log entry:

   ~~~xml
   pattern="%h %l %u %t &quot;%r&quot; %s %b &quot;%{Referer}i&quot; &quot;%{User-Agent}i&quot; %D"
   ~~~

   When you are finished with your edits, the `AccessLogValve` should look something like the following:

   ~~~xml
   <Valve className="org.apache.catalina.valves.AccessLogValve"
      directory="logs"  
      prefix="access."
      suffix=".log"
      pattern="%h %l %u %t &quot;%r&quot; %s %b &quot;%{Referer}i&quot; &quot;%{User-Agent}i&quot; %D" />
   ~~~

2. Verify the changes to the access log have taken affect.
   Restart Tomcat and verify an access log has been generated in the `${tomcat_home}/logs/` directory:

   ~~~bash
   $ ls -l /home/tds/workshop/apache-tomcat-7.0.32/logs
   -rw-r--r-- 1 tds workshop 0 Jul 24 12:25 access.2013-07-24.log
   -rw-r--r-- 1 tds workshop  4270 Jul 24 12:26 catalina.2013-07-24.log
   -rw-r--r-- 1 tds workshop 19095 Jul 24 12:26 catalina.out
   -rw-r--r-- 1 tds workshop     0 Jul 24 12:25 host-manager.2013-07-24.log
   -rw-r--r-- 1 tds workshop  3845 Jul 24 12:26 localhost.2013-07-24.log
   -rw-r--r-- 1 tds workshop     0 Jul 15 09:39 localhost_access_log.2013-07-15.txt
   -rw-r--r-- 1 tds workshop     0 Jul 24 12:25 manager.2013-07-24.log
   ~~~

### Access log format

The access log entry format we are using is almost identical to the standard combined logging format with an addition: the %D which is used for documenting the Time taken to process the request, in milliseconds will appear at the end of each log entry:

~~~xml
pattern="%h %l %u %t &quot;%r&quot; %s %b &quot;%{Referer}i&quot; &quot;%{User-Agent}i&quot; %D"
~~~

### Access log format

{%include note.html content="
For more information on access log format configuration, see the Tomcat [Valve Component](http://tomcat.apache.org/tomcat-7.0-doc/config/valve.html) Documentation.
" %}


The above pattern makes use of the following codes:

 * `%h` - Remote host name (or IP address if resolveHosts is false)
 * `%l` - Remote logical username from identd (always returns '-')
 * `%u` - Remote user that was authenticated (if any), else '-'
 * `%t` - Date and time, in Common Log Format
 * `%r` - First line of the request (method and request URI)
 * `%s` - HTTP status code of the response
 * `%b` - Bytes sent, excluding HTTP headers, or '-' if zero
 * `%D` - Time taken to process the request, in millis

The above pattern translates into:

~~~bash
127.0.0.1 - admin [21/Oct/2012:12:31:59 -0600] "GET /manager/html HTTP/1.1" 200 17578 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:10.0.7) Gecko/20120829 Firefox/10.0.7" 8
~~~

Another way of looking at it:

|---------|---------|-------|
| pattern | meaning | value |
|:--------|:--------|:------|
| `%h` | Remote host  | 127.0.0.1 |
| `%l` | Remote logical username from identd | - |
| `%u` | Authenticated user       | admin |
| `%t` | Time and date of request | [21/Oct/2012:12:31:59 -0600] |
| `%r` | HTTP request method      | GET |
| `%r` | Request URI              | /manager/html |
| `%r` | Protocol used            | HTTP/1.1 |
| `%s`  | HTTP server response    | 200 |
| `%b` | Bytes transferred        | 17578 |
| `%{Referer}` | Referer          | - |
| `%{User-Agent}`| User Agent | Mozilla/5.0 (X11; Linux x86_64; rv:10.0.7) Gecko/20120829 Firefox/10.0.7 |
| `%D` | Response time (in milliseconds) | 8 |
