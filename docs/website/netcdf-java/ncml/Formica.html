<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <title>Untitled Document</title>
  <link href="../cdm.css" rel="stylesheet" type="text/css"/>
</head>

<body>
<h1><strong>Forecast Model Run Collection</strong></h1>

<p><em>last changed: Aug 11, 2006 </em></p>

<h2>1. Current design to track GRIB inventory in the TDS </h2>

<h3><strong>ForecastModelRunInventory</strong></h3>

<p>Encapsulates actual inventory of one GridDataset, writes &ldquo;.fmrInv.xml&quot; XML files to summarize the inventory. Reads it back if it exists, instead
  of reading the GridDataset:</p>
<blockquote>
  <p>public static ForecastModelRun <strong>open</strong>(ucar.nc2.util.DiskCache2 cache, String ncfileLocation, int mode); </p>

  <p> public static ForecastModelRun <strong>readXML</strong>(String xmlLocation);</p>
</blockquote>
<p> On motherlode, these files are created in a chron job.</p>

<p> There is some specialization for GRIB files, in order to determine the missing data. A GridDataset will be square in vert X time coordinate, but GRIB files
  may have missing planes that we want to track for inventory purposes. This may not matter for formica. </p>
<pre id="line1">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;forecastModelRun dataset=&quot;DGEX_Alaska_12km_20060317_1200.grib2&quot; runTime=&quot;2006-03-17 12:00:00Z&quot;&gt;
<br><strong>1)</strong>&lt;vertCoord id=&quot;0&quot; name=&quot;pressure&quot; units=&quot;hPa&quot;&gt;100000.0 85000.0 70000.0 50000.0 25000.0&lt;/vertCoord&gt;<br>  &lt;vertCoord id=&quot;1&quot; name=&quot;pressure_difference&quot; units=&quot;hPa&quot;&gt;3000.0 6000.0 9000.0 12000.0 15000.0 18000.0&lt;/vertCoord&gt;<br>  &lt;vertCoord id=&quot;2&quot; name=&quot;pressure4&quot; units=&quot;hPa&quot;&gt;85000.0 70000.0 50000.0&lt;/vertCoord&gt;<br>  &lt;vertCoord id=&quot;3&quot; name=&quot;pressure1&quot; units=&quot;hPa&quot;&gt;85000.0 70000.0 50000.0 25000.0&lt;/vertCoord&gt;
<br><strong>2)</strong>&lt;offsetHours id=&quot;0&quot;&gt;<br>    90.0 96.0 102.0 108.0 114.0 120.0 126.0 132.0 138.0 144.0 150.0 156.0 162.0 168.0 174.0 180.0 186.0 192.0<br>    &lt;variable name=&quot;Geopotential_height&quot; vert_id=&quot;0&quot;&gt;<br><strong>3)</strong>    &lt;missing&gt;9,0 9,3 10,0 10,3 11,1 11,2 11,4&lt;/missing&gt;<br>    &lt;/variable&gt;<br>    &lt;variable name=&quot;Maximum_temperature&quot; /&gt;<br>    &lt;variable name=&quot;Minimum_temperature&quot; /&gt;<br>    &lt;variable name=&quot;Relative_humidity_pressure&quot; vert_id=&quot;2&quot;&gt;<br>      &lt;missing&gt;9,2 10,2 11,0 11,1&lt;/missing&gt;<br>    &lt;/variable&gt;<br>    &lt;variable name=&quot;Surface_Lifted_Index&quot; /&gt;<br>    &lt;variable name=&quot;Temperature&quot; vert_id=&quot;1&quot;&gt;<br>      &lt;missing&gt;11,0 11,1 11,2 11,3&lt;/missing&gt;<br>    &lt;/variable&gt;<br>    &lt;variable name=&quot;Temperature_pressure&quot; vert_id=&quot;2&quot;&gt;<br>      &lt;missing&gt;9,0 9,1 10,0 10,1 11,2&lt;/missing&gt;<br>    &lt;/variable&gt;<br>    &lt;variable name=&quot;U_component_of_wind&quot; vert_id=&quot;1&quot;&gt;<br>      &lt;missing&gt;11,0 11,1 11,2&lt;/missing&gt;<br>    &lt;/variable&gt;<br>    &lt;variable name=&quot;U_component_of_wind_pressure&quot; vert_id=&quot;3&quot;&gt;<br>      &lt;missing&gt;9,0 9,1 9,3 10,0 10,1 10,3 11,2&lt;/missing&gt;<br>    &lt;/variable&gt;<br>    &lt;variable name=&quot;V_component_of_wind_pressure&quot; vert_id=&quot;3&quot;&gt;<br>      &lt;missing&gt;9,2 10,2 11,0 11,1 11,3&lt;/missing&gt;<br>    &lt;/variable&gt;<br>  &lt;/offsetHours&gt;
<br>  &lt;offsetHours id=&quot;1&quot;&gt;<br>    90.0<br>    &lt;variable name=&quot;Geopotential_height_surface&quot; /&gt;<br>  &lt;/offsetHours&gt;
<br>  &lt;offsetHours id=&quot;2&quot;&gt;<br>    90.0 96.0 102.0 108.0 114.0 120.0 126.0 132.0 138.0 144.0 150.0 162.0 168.0 174.0 180.0 186.0 192.0<br>    &lt;variable name=&quot;MSLP_Eta_Reduction&quot; /&gt;<br>    &lt;variable name=&quot;Pressure&quot; /&gt;<br>    &lt;variable name=&quot;Relative_humidity_height_above_ground&quot; /&gt;<br>    &lt;variable name=&quot;V_component_of_wind_height_above_ground&quot; /&gt;<br>  &lt;/offsetHours&gt;
<br>  &lt;offsetHours id=&quot;3&quot;&gt;<br>    90.0 96.0 102.0 108.0 114.0 120.0 126.0 132.0 138.0 144.0 156.0 162.0 168.0 174.0 180.0 186.0 192.0<br>    &lt;variable name=&quot;Pressure_reduced_to_MSL&quot; /&gt;<br>  &lt;/offsetHours&gt;
<br>  &lt;offsetHours id=&quot;4&quot;&gt;<br>    90.0 96.0 102.0 108.0 114.0 120.0 126.0 132.0 138.0 156.0 162.0 168.0 174.0 180.0 186.0 192.0<br>    &lt;variable name=&quot;Relative_humidity&quot; vert_id=&quot;1&quot; /&gt;<br>    &lt;variable name=&quot;Temperature_height_above_ground&quot; /&gt;<br>    &lt;variable name=&quot;Total_cloud_cover&quot; /&gt;<br>    &lt;variable name=&quot;U_component_of_wind_height_above_ground&quot; /&gt;<br>    &lt;variable name=&quot;V_component_of_wind&quot; vert_id=&quot;1&quot; /&gt;<br>    &lt;variable name=&quot;Vertical_velocity_pressure&quot; /&gt;<br>  &lt;/offsetHours&gt;
<br>  &lt;offsetHours id=&quot;5&quot;&gt;<br>    84.0 90.0 96.0 102.0 108.0 114.0 120.0 126.0 132.0 150.0 156.0 162.0 168.0 174.0 180.0 186.0<br>    &lt;variable name=&quot;Total_precipitation&quot; /&gt;<br>  &lt;/offsetHours&gt;

<strong>4)</strong>&lt;horizBB west=&quot;-139.530&quot; east=&quot;-14.202&quot; south=&quot;-0.569&quot; north=&quot;32.405&quot; /&gt;<br>&lt;/forecastModelRun&gt;</pre>
<ol>
  <li>The vertical coordinates, referenced by <strong>vert_id</strong> in the variable elements.</li>
  <li>The set of offset hours, and the list of variables that use them. Assumes hours: is that a problem?</li>
  <li>A list of missing planes for this variable (timeIndex, vertIndex), reletive to the time X vert coordinate matrix.</li>
  <li>Optionally track the lat/lon bounding box.</li>
</ol>
<p>This file is created without reference to the FmrcDefinition. If we had it, could show the anomolies against that. </p>

<h3>FmrcDefinition</h3>

<p> Defines the expected inventory of a Forecast Model Run Collection. Writes to an &ldquo;.fmrcDefinition.xml&rdquo; XML file. TDS keeps these in
  <a href="https://motherlode.ucar.edu:8443/thredds/content/modelInventory/">https://motherlode.ucar.edu:8443/thredds/content/modelInventory/</a>. </p>

<p> Can create one from a ForecastModelRunCollection: </p>
<blockquote>
  <p> public void <strong>makeFromCollectionInventory</strong>(ForecastModelRunCollection fmrc); </p>
</blockquote>
<p> You need to review and hand edit these. An example: </p>
<pre><span class="pi">  &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong>1)</strong>&lt;<span class="start-tag">fmrcDefinition</span><span class="attribute-name"> dataset</span>=<span class="attribute-value">"NCEP-NDFD-CONUS_5km" </span><span class="attribute-name"><strong>suffixFilter</strong></span>=<span class="attribute-value">".grib2"</span>&gt;

<strong>2)</strong>  &lt;<span class="start-tag">vertCoord</span><span class="attribute-name"> id</span>=<span class="attribute-value">"0" </span><span class="attribute-name">name</span>=<span class="attribute-value">"isobaric1"</span>&gt;250.0 500.0 700.0 850.0&lt;/<span class="end-tag">vertCoord</span>&gt;
    &lt;<span class="start-tag">vertCoord</span><span class="attribute-name"> id</span>=<span class="attribute-value">"1" </span><span class="attribute-name">name</span>=<span class="attribute-value">"isobaric"</span>&gt;250.0 300.0 500.0 700.0 850.0 1000.0&lt;/<span class="end-tag">vertCoord</span>&gt;
    &lt;<span class="start-tag">vertCoord</span><span class="attribute-name"> id</span>=<span class="attribute-value">"2" </span><span class="attribute-name">name</span>=<span class="attribute-value">"isobaric2"</span>&gt;300.0 400.0 500.0 700.0 850.0 1000.0&lt;/<span class="end-tag">vertCoord</span>&gt;

<strong>3)</strong>  &lt;<span class="start-tag">offsetHours</span><span class="attribute-name"> id</span>=<span class="attribute-value">"0"</span>&gt;0.0 12.0 24.0 36.0 48.0 60.0 72.0 84.0 96.0 108.0 120.0 132.0 144.0 156.0 168.0 180.0 192.0 204.0 216.0 228.0 240.0&lt;/<span class="end-tag">offsetHours</span>&gt;
    &lt;<span class="start-tag">offsetHours</span><span class="attribute-name"> id</span>=<span class="attribute-value">"1"</span>&gt;12.0 24.0 36.0 48.0 60.0 72.0 84.0 96.0 108.0 120.0 132.0 144.0 156.0 168.0 180.0 192.0 204.0 216.0 228.0 240.0&lt;/<span class="end-tag">offsetHours</span>&gt;
</pre>
<pre id="line8"><strong>4)</strong>  &lt;<span class="start-tag">runSequence</span><span class="attribute-name"><strong>
  allUseSeq</strong></span>=<span class="attribute-value">"0"</span>&gt;
      &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Absolute_vorticity" </span><span class="attribute-name">vertCoord</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
      &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Geopotential_height" </span><span class="attribute-name">vertCoord</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
      &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"N5-wave_geopotential_height" </span><span class="attribute-name">/</span>&gt;
      &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Pressure_reduced_to_MSL" </span><span class="attribute-name">/</span>&gt;
      &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Relative_humidity" </span><span class="attribute-name">vertCoord</span>=<span class="attribute-value">"2" </span><span class="attribute-name">/</span>&gt;
      &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Relative_humidity_layer_between_two_pressure_difference_from_ground" </span><span class="attribute-name">/</span>&gt;
      &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Relative_humidity_layer_between_two_sigmas" </span><span class="attribute-name">/</span>&gt;
      &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Temperature" </span><span class="attribute-name">vertCoord</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;/<span class="end-tag">runSequence</span>&gt;
  
    &lt;<span class="start-tag">runSequence</span><span class="attribute-name"> allUseSeq</span>=<span class="attribute-value">"1"</span>&gt;
      &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Convective_precipitation" </span><span class="attribute-name">/</span>&gt;
      &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Total_precipitation" </span><span class="attribute-name">/</span>&gt;
     &lt;/<span class="end-tag">runSequence</span>&gt;
  &lt;/<span class="end-tag">fmrcDefinition</span>&gt;
</pre>
<ol>
  <li>A convenient place to specify that these files end in <strong><em>.grib2</em></strong></li>
  <li>The possible vertical coordinates, referenced by <strong>vertCoord</strong> in the variable elements.
    <span class="style1">Maybe should have units? </span></li>
  <li>The possible time coordinates, represented as offset hours. <span class="style1">Assumes hours: is that a problem?</span></li>
  <li>The list of variables that use time coord 0, ie
    &lt;<span class="start-tag">offsetHours</span><span class="attribute-name"> id</span>=<span class="attribute-value">"0"</span>&gt;. The
    <strong>allUseSeq</strong> means that all model runs use time coord 0.
  </li>
</ol>
<p>If a model run collection can be represented by this format, it is called <strong><em>regular</em>. </strong>Things can be more complicated when different
  run times use different time coordinates. We then need to represent the collection as a sequence of runs, for example: </p>
<pre>  &lt;<span class="start-tag">offsetHours</span><span class="attribute-name"> id</span>=<span class="attribute-value">"0"</span>&gt;0.0 1.0 2.0 3.0 6.0 9.0 12.0&lt;/<span class="end-tag">offsetHours</span>&gt;
  &lt;<span class="start-tag">offsetHours</span><span class="attribute-name"> id</span>=<span class="attribute-value">"1"</span>&gt;0.0 1.0 2.0 3.0&lt;/<span class="end-tag">offsetHours</span>&gt;
</pre>
<pre id="line8">  &lt;<span class="start-tag">runSequence</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"0.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"1.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"2.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"3.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"4.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"5.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"6.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"7.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"8.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"9.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"10.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"11.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"12.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"13.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"14.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"15.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"16.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"17.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"18.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"19.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"20.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"21.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"22.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"23.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"24.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;

    &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Accumulated_snow" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Baseflow-groundwater_runoff" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Cloud_water" </span><span class="attribute-name">vertCoord</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Convective_Avail_Pot_Energy" </span><span class="attribute-name">/</span>&gt;
  &lt;/<span class="start-tag">runSequence</span>&gt;</pre>
<p> Here the 0, 3, 6, etc hour <strong>runs</strong> have forecasts out to 9 hours, while the rest go out to 3. Repeating patterns like this can be more
  concisely represented like: </p>
<pre id="line8">  &lt;<span class="start-tag">runSequence</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"0.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"1.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"2.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"1" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">run</span><span class="attribute-name"> runHour</span>=<span class="attribute-value">"3.0" </span><span class="attribute-name">offsetHourSeq</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
   
    &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Accumulated_snow" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Baseflow-groundwater_runoff" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Cloud_water" </span><span class="attribute-name">vertCoord</span>=<span class="attribute-value">"0" </span><span class="attribute-name">/</span>&gt;
    &lt;<span class="start-tag">variable</span><span class="attribute-name"> name</span>=<span class="attribute-value">"Convective_Avail_Pot_Energy" </span><span class="attribute-name">/</span>&gt;
  &lt;/<span class="start-tag">runSequence</span>&gt;</pre>
<p>In this case the first and last must have the same <span class="attribute-name"><strong>offsetHourSeq</strong> value </span>, and the pattern is generated
  out to 24 hours. </p>

<p>One more possible complication:</p>
<pre>&lt;vertCoord id=&quot;1&quot; name=&quot;isobaric1&quot;&gt;200.0 300.0 500.0 700.0 850.0&lt;/vertCoord&gt;
&lt;offsetHours id=&quot;5&quot;&gt;0.0 1.0 2.0 3.0 4.0 5.0 6.0 7.0 8.0 9.0 12.0&lt;/offsetHours&gt;<br>&lt;offsetHours id=&quot;8&quot;&gt;0.0 1.0 2.0 3.0&lt;/offsetHours&gt;

&lt;runSequence&gt;<br>  &lt;run runHour=&quot;0.0&quot; offsetHourSeq=&quot;5&quot;/&gt;<br>  &lt;run runHour=&quot;1.0&quot; offsetHourSeq=&quot;8&quot;/&gt;<br>  &lt;run runHour=&quot;2.0&quot; offsetHourSeq=&quot;8&quot;/&gt;<br>  &lt;run runHour=&quot;3.0&quot; offsetHourSeq=&quot;5&quot;/&gt;

  &lt;variable name=&quot;<strong>Pressure_vertical_velocity</strong>&quot; vertCoord=&quot;1&quot;&gt;<br>    &lt;vertTimeCoord <strong>restrict</strong>=&quot;850.0 700.0 500.0 300.0&quot;&gt;<strong>2.0
    6.0</strong>&lt;/vertTimeCoord&gt;
    &lt;vertTimeCoord <strong>restrict</strong>=&quot;500.0&quot;&gt;<strong>12.0</strong>&lt;/vertTimeCoord&gt;<br>  &lt;/variable&gt; 
&lt;/runSequence&gt;</pre>
<p>This says that for the <strong>Pressure_vertical_velocity</strong> variable, the 2.0 and 6.0 offset hours are only output on the 850.0, 700.0, 500.0 and
  300.0 vertical levels, while the 12.0 forecast hour only appears on the 500.0 level. </p>

<h3>FmrcInventory</h3>

<p>A <em><strong>FmrcInventory</strong></em> is a collection of <strong>ForecastModelRunInventory</strong>, along with an <strong>FmrcDefinition</strong>. This
  allows you to tell what inventory is missing. </p>

<p>This method will scan a directory, create <strong>ForecastModelRunInventory</strong> objects for each file, find the <strong>FmrcDefinition, </strong>and
  create the resulting <strong>FmrcInventory:</strong></p>
<pre>  /**<br>   * Create a ForecastModelRun Collection from the files in a directory.<br>   * @param <strong>fmrcDefinitionPath</strong> put/look for fmrc definition files in this directory<br>   * @param <strong>collectionName</strong> name of collection<br>   * @param <strong>fmr_cache</strong> cache fmr inventory files here<br>   * @param <strong>dirName</strong>  scan this directory<br>   * @param <strong>suffix</strong> filter on this suffix<br>   * @param <strong>mode</strong> one of the ForecastModelRun.OPEN_ modes<br>   * @return <strong>ForecastModelRunCollection</strong> or null if no files exist<br>   * @throws Exception<br>   */<br>  public static <strong>FmrcInventory</strong> <strong>make</strong>(String fmrcDefinitionPath, String collectionName,<br>          ucar.nc2.util.DiskCache2 fmr_cache, String dirName, String suffix, int mode);<br>
</pre>
<p>Once you have constructed, you can create an <em><strong>forecastModelRunCollectionInventory</strong></em> XML document that summarize the inventory:</p>

<p>&nbsp; </p>
<hr>
<h2>2. CDM / NcML </h2>

<h3>ucar.nc2.dt.Grid</h3>
<pre>public interface <strong>GridCoordSystem</strong> {
   public String <strong>getName</strong>();
   public List <strong>getDomain</strong>();

   // axes
   public boolean <strong>isProductSet</strong>(); // all are 1D
   public List <strong>getCoordinateAxes</strong>();
   public CoordinateAxis <strong>getXHorizAxis</strong>();
   public CoordinateAxis <strong>getYHorizAxis</strong>();
   public CoordinateAxis1D <strong>getVerticalAxis</strong>();
   public CoordinateAxis <strong>getTimeAxis</strong>();
   public CoordinateAxis1D <strong>getEnsembleAxis</strong>();
   public CoordinateAxis1DTime <strong>getRunTimeAxis</strong>();</pre>
<pre>   // transforms
   public List <strong>getCoordinateTransforms</strong>();
   public ProjectionCT <strong>getProjectionCT</strong>();
   public ucar.unidata.geoloc.ProjectionImpl <strong>getProjection</strong>();
   public VerticalCT <strong>getVerticalCT</strong>();
   public ucar.unidata.geoloc.vertical.VerticalTransform <strong>getVerticalTransform</strong>();</pre>
<pre>   // horiz
   public boolean <strong>isLatLon</strong>();              // else has a Projection
   public boolean <strong>isRegularSpatial</strong>();      // x,y are 1D and regularly spaced
   public ucar.unidata.geoloc.LatLonRect <strong>getLatLonBoundingBox</strong>();
   public ucar.unidata.geoloc.ProjectionRect <strong>getBoundingBox</strong>();
   public java.util.List <strong>getRangesFromLatLonRect</strong>(ucar.unidata.geoloc.LatLonRect llbb);
   public int[] <strong>findXYindexFromCoord</strong>(double x_coord, double y_coord, int[] result);</pre>
<pre>   // vertical
   public boolean <strong>isZPositive</strong>();</pre>
<pre>   // time
   public thredds.datatype.DateRange <strong>getDateRange</strong>();   
   public boolean <strong>hasTimeAxis</strong>();
   public boolean <strong>hasTimeAxis1D</strong>();
   public CoordinateAxis1DTime <strong>getTimeAxis1D</strong>();
   public CoordinateAxis1DTime <strong>getTimeAxisForRun</strong>(int run_index);
}</pre>
<h3>NcML Aggregation</h3>

<p><strong>A forecastModelRunCollection</strong> aggregation is similar to a <strong>JoinNew</strong> in that each file defines one slice in a synthetic
  dimension: </p>
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;netcdf xmlns=&quot;https://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;<br>  &lt;aggregation dimName=&quot;run&quot; type=&quot;<strong>forecastModelRunCollection</strong>&quot;&gt;<br>    &lt;scan location=&quot;C:/data/grib/nam/c20s/&quot; suffix=&quot;.grib1&quot; enhance=&quot;true&quot; dateFormatMark=&quot;NAM_CONUS_20km_surface_#yyyyMMdd_HHmm&quot;/&gt;<br>  &lt;/aggregation&gt;<br>&lt;/netcdf&gt;
</pre>
<p>The synthesized runtime coordinate:</p>
<pre>   String run(run=7);<br>     :long_name = &quot;Run time for ForecastModelRunCollection&quot;;<br>     :_CoordinateAxisType = &quot;RunTime&quot;;
</pre>
<p>is constructed in several ways. The <strong>dateFormatMark</strong> attribute can be used when the time is encoded in the filename in a uniform way. </p>

<p>When you explicitly list the datasets, you can add a coordinate value. </p>
<pre>&lt;aggregation dimName=&quot;run&quot; type=&quot;<strong>forecastModelRunCollection</strong>&quot;&gt;<br>  &lt;netcdf location=&quot;/my/data/modelrun01.nc&quot; coordValue=&quot;0&quot;/&gt;<br>  &lt;netcdf location=&quot;/my/data/modelrun02.nc&quot; coordValue=&quot;1&quot;/&gt;<br>  &lt;netcdf location=&quot;/my/data/modelrun03.nc&quot; coordValue=&quot;2&quot;/&gt;<br>&lt;/aggregation&gt;</pre>
<p><strong>A forecastModelRunCollection</strong> aggregation creates a NetcdfDataset, which can wrapped in a GridDataset to create variables with 2 time
  dimensions:</p>
<pre>  float varname( runTime, forecastTime, z_coord, y_coord, x_coord);</pre>
<p>We thus need a two dimensional time variable:</p>
<pre>  float forecastTime( runTime, forecastTime);
    :long_name = &quot;forecast time&quot;;<br>    :units = &quot;hour since 2006-03-17T00:00:00Z&quot;;<br>    :_CoordinateAxisType = &quot;Time&quot;;</pre>
<p><strong> Case 1. </strong></p>

<p> Assume the time units are all the same in the nested datasets. this is the case for <em>aggFmrcNetcdf.xml</em>, that works on the files in <em><strong>C:/data/ncmodels/</strong></em>
  : </p>
<pre>   double valtime(run=14, record=11);<br>     :long_name = &quot;valid time&quot;;<br>     :units = &quot;hours since 1992-1-1&quot;;<br>     :_CoordinateAxisType = &quot;Time&quot;;</pre>
<pre> data:</pre>
<pre> {
   {122100.0, 122106.0, 122112.0, 122118.0, 122124.0, 122130.0, 122136.0, 122142.0, 122148.0, 122154.0, 122160.0},
   {122112.0, 122118.0, 122124.0, 122130.0, 122136.0, 122142.0, 122148.0, 122154.0, 122160.0, 122166.0, 122172.0},
   {122124.0, 122130.0, 122136.0, 122142.0, 122148.0, 122154.0, 122160.0, 122166.0, 122172.0, 122178.0, 122184.0},
   {122136.0, 122142.0, 122148.0, 122154.0, 122160.0, 122166.0, 122172.0, 122178.0, 122184.0, 122190.0, 122196.0},
   {122148.0, 122154.0, 122160.0, 122166.0, 122172.0, 122178.0, 122184.0, 122190.0, 122196.0, 122202.0, 122208.0},
   {122160.0, 122166.0, 122172.0, 122178.0, 122184.0, 122190.0, 122196.0, 122202.0, 122208.0, 122214.0, 122220.0},
   {122172.0, 122178.0, 122184.0, 122190.0, 122196.0, 122202.0, 122208.0, 122214.0, 122220.0, 122226.0, 122232.0},
   {122184.0, 122190.0, 122196.0, 122202.0, 122208.0, 122214.0, 122220.0, 122226.0, 122232.0, 122238.0, 122244.0},
   {122196.0, 122202.0, 122208.0, 122214.0, 122220.0, 122226.0, 122232.0, 122238.0, 122244.0, 122250.0, 122256.0},
   {122208.0, 122214.0, 122220.0, 122226.0, 122232.0, 122238.0, 122244.0, 122250.0, 122256.0, 122262.0, 122268.0},
   {122220.0, 122226.0, 122232.0, 122238.0, 122244.0, 122250.0, 122256.0, 122262.0, 122268.0, 122274.0, 122280.0},
   {122232.0, 122238.0, 122244.0, 122250.0, 122256.0, 122262.0, 122268.0, 122274.0, 122280.0, 122286.0, 122292.0},
   {122244.0, 122250.0, 122256.0, 122262.0, 122268.0, 122274.0, 122280.0, 122286.0, 122292.0, 122298.0, 122304.0},
   {122256.0, 122262.0, 122268.0, 122274.0, 122280.0, 122286.0, 122292.0, 122298.0, 122304.0, 122310.0, 122316.0}
 }</pre>
<p><strong>Case 2. </strong></p>

<p> The time units differ for the nested datasets. This is the case for <em>aggFmrcGrib.xml</em>, that works on the files in
  <em><strong>C:/data/grib/nam/c20s/</strong></em> . So we have to adjust the values. </p>
<pre>   int time(run=7, time=29);<br>     :long_name = &quot;forecast time&quot;;<br>     :units = &quot;hour since 2006-03-15T12:00:00Z&quot;;<br>     :_CoordinateAxisType = &quot;Time&quot;;</pre>
<pre> data:</pre>
<pre> {
   {0, 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84},
   {6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87, 90},
   {12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87, 90, 93, 96},
   {18, 21, 24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87, 90, 93, 96, 99, 102},
   {24, 27, 30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87, 90, 93, 96, 99, 102, 105, 108},
   {30, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87, 90, 93, 96, 99, 102, 105, 108, 111, 114},
   {36, 39, 42, 45, 48, 51, 54, 57, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87, 90, 93, 96, 99, 102, 105, 108, 111, 114, 117, 120}
 }
</pre>
<p>Indicate that the time coordinate units change, with the <strong>timeUnitsChange</strong> attribute :</p>
<pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;netcdf xmlns=&quot;https://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;<br>  &lt;aggregation dimName=&quot;run&quot; type=&quot;forecastModelRunCollection&quot; <strong>timeUnitsChange</strong>=&quot;true&quot;&gt;<br>    &lt;scan location=&quot;C:/data/grib/nam/c20s/&quot; suffix=&quot;.grib1&quot; enhance=&quot;true&quot; dateFormatMark=&quot;NAM_CONUS_20km_surface_#yyyyMMdd_HHmm&quot;/&gt;<br>  &lt;/aggregation&gt;<br>&lt;/netcdf&gt;
 </pre>
<h3>Persistence</h3>

<p>Type.JOIN_EXISTING will write an aggegation XML document to diskCache2 ().</p>

<p> String cache2 = ServletParams.getInitParameter(&quot;CacheAged&quot;, contentPath + &quot;cacheAged/&quot;); = &quot;/data/tmp/thredds/cacheAged/&quot; </p>
<hr>
<h2>3. Formica Project</h2>

<p> An FMRC can be thought of as a collection of grids (aka fields or parameters or variables) with 2 or 3 spatial dimensions and 2 time dimensions. We will
  provide subsets of the FMRC by selecting a 1D subset of the 2D times:</p>
<ol>
  <li><strong>Forecast Model Run Dataset</strong>: all forecast times for a single run time. (horizontal row). <strong>Time dimension = forecast times</strong>.
  </li>
  <li><strong>Constant Forecast Date Dataset</strong>: all run times for a single forecast date, i.e. successively shorter forecasts of the same endpoint.
    (diagonal). <strong>Time dimension = run times</strong>.
  </li>
  <li><strong>Constant Forecast Offset Dataset</strong>: contain the grids with the same forecast time offset, e.g. all the 3 hour forecasts in the collection
    (vertical column) <strong>Time dimension = forecast times</strong>. Auxilary coordinate= <strong>run times</strong>.
  </li>
  <li><strong>Best time series dataset</strong>: contains the first time step in each of the runs, plus all of the time steps in the most recent run.(first
    vertical column plus the top row). <strong>Time dimension = forecast times</strong>. Auxilary coordinate= <strong>run times</strong>.
  </li>
</ol>
<p> If there are N Forecast Model Runs (FMR) files in a collection, and each FMR contains M forecast dates, then there are M constant offset datasets and N+M
  constant forecast date datasets. By integrating virtual datasets directly into the TDS, we can automatically generate these N + 2M new datasets in a THREDDS
  catalog and provide OPeNDAP (and possibly WCS) URLs through which the virtual datasets can be accessed. The N original FMR files can be explicitly named in
  the TDS configuration catalog, or if the files are all contained under a single directory, the directory can be automatically scanned to determine the
  files. </p>

<h3>Uniform Forecast Hours</h3>

<p>NAM 80 km</p>

<p>Number of 2D records present (or) Number present / Number expected.</p>
<table border="1">
<tbody>
<tr>
  <td></td>
  <th colspan="100">Valid Time offset (hours)</th>
</tr>
<tr>
  <th>Run Time</th>
  <th>Total</th>
  <th>0.0</th>
  <th>6.0</th>
  <th>12.0</th>
  <th>18.0</th>
  <th>24.0</th>
  <th>30.0</th>
  <th>36.0</th>
  <th>42.0</th>
  <th>48.0</th>
  <th>54.0</th>
  <th>60.0</th>
</tr>
<tr>
  <th>2006-07-14 12.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-14 00.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-13 12.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-13 00.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-12 12.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-12 00.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-11 12.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-11 00.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-10 12.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-10 00.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-09 12.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-09 00.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-08 12.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-08 00.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
<tr>
  <th>2006-07-07 12.00Z</th>
  <td align="center">1847</td>
  <td align="center" bgcolor="#00ff00">167</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
  <td align="center" bgcolor="#00ff00">168</td>
</tr>
</tbody>
</table>
<p>&nbsp;  </p>

<h3>Non Uniform Forecast Hours</h3>

<p>RUC hourly model:</p>

<p>Number of 2D records present (or) Number present / Number expected.</p>
<table border="1">
<tbody>
<tr>
  <td></td>
  <th colspan="100">Valid Time offset (hours)</th>
</tr>
<tr>
  <th>Run Time</th>
  <th>Total</th>
  <th>0.0</th>
  <th>1.0</th>
  <th>2.0</th>
  <th>3.0</th>
  <th>4.0</th>
  <th>5.0</th>
  <th>6.0</th>
  <th>7.0</th>
  <th>8.0</th>
  <th>9.0</th>
  <th>12.0</th>
</tr>
<tr>
  <th>2006-07-14 15.00Z</th>
  <td align="center">149/1358</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#ff5555"><strong>0/142</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/141</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/149</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/141</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/141</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/147</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/25</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/27</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/148</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/148</strong></td>
</tr>
<tr>
  <th>2006-07-14 14.00Z</th>
  <td align="center">606</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
</tr>
<tr>
  <th>2006-07-14 13.00Z</th>
  <td align="center">606</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
</tr>
<tr>
  <th>2006-07-14 12.00Z</th>
  <td align="center">1438</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">156</td>
  <td align="center" bgcolor="#00ff00">31</td>
  <td align="center" bgcolor="#00ff00">33</td>
  <td align="center" bgcolor="#00ff00">157</td>
  <td align="center" bgcolor="#00ff00">157</td>
</tr>
<tr>
  <th>2006-07-14 11.00Z</th>
  <td align="center">606</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
</tr>
<tr>
  <th>2006-07-14 10.00Z</th>
  <td align="center">606</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
</tr>
<tr>
  <th>2006-07-14 09.00Z</th>
  <td align="center">1438</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">156</td>
  <td align="center" bgcolor="#00ff00">31</td>
  <td align="center" bgcolor="#00ff00">33</td>
  <td align="center" bgcolor="#00ff00">157</td>
  <td align="center" bgcolor="#00ff00">157</td>
</tr>
<tr>
  <th>2006-07-14 08.00Z</th>
  <td align="center">606</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
</tr>
<tr>
  <th>2006-07-14 07.00Z</th>
  <td align="center">606</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
</tr>
<tr>
  <th>2006-07-14 06.00Z</th>
  <td align="center">1438</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">156</td>
  <td align="center" bgcolor="#00ff00">31</td>
  <td align="center" bgcolor="#00ff00">33</td>
  <td align="center" bgcolor="#00ff00">157</td>
  <td align="center" bgcolor="#00ff00">157</td>
</tr>
<tr>
  <th>2006-07-14 05.00Z</th>
  <td align="center">606</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
</tr>
<tr>
  <th>2006-07-14 04.00Z</th>
  <td align="center">149/581</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#ff5555"><strong>0/142</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/141</strong></td>
  <td align="center" bgcolor="#ff5555"><strong>0/149</strong></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
  <td align="center" bgcolor="#00ff00"></td>
</tr>
<tr>
  <th>2006-07-14 03.00Z</th>
  <td align="center">1438</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">150</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">158</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">149</td>
  <td align="center" bgcolor="#00ff00">156</td>
  <td align="center" bgcolor="#00ff00">31</td>
  <td align="center" bgcolor="#00ff00">33</td>
  <td align="center" bgcolor="#00ff00">157</td>
  <td align="center" bgcolor="#00ff00">157</td>
</tr>
</tbody>
</table>
<ol>
  <li>The first row is partially complete (missing grids in red) because its currently being written.</li>
  <li>The 0,3 etc runs go out to 12 hours, the rest go out to3 hours</li>
  <li>Different numbers across indicate that different variables have different forecast hour patterns.</li>
  <li>The red columns in the next to bottom row indicate data that was never recieved for one reason or another.</li>
</ol>
<p>&nbsp;</p>

<h3>TDS Configuration </h3>

<p>Add a new element, somewhat like <strong>datasetScan</strong>: </p>
<pre>
&lt;<strong>datasetFmrc</strong> <strong>path="models/GFS/Alaska_191km"</strong> name="GFS Alaska 191km Model" serviceName="myserver" &gt;

 &lt;netcdf xmlns=&quot;https://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2&quot;&gt;<br>   &lt;aggregation dimName=&quot;run&quot; type=&quot;<strong>forecastModelRunCollection</strong>&quot;&gt;<br>     &lt;scan <strong>location=&quot;/data/ldm/grib/gfs/Alaska_191km/</strong>&quot; suffix=&quot;.grib1&quot; dateFormatMark=&quot;NAM_CONUS_20km_surface_#yyyyMMdd_HHmm&quot;/&gt;<br>   &lt;/aggregation&gt;<br> &lt;/netcdf&gt;

&lt;/<strong>datasetFmrc</strong>&gt;
</pre>
<p>Generates the following catalog: </p>
<pre>&lt;dataset ID="<strong>models/GFS/Alaska_191km</strong>" name="GFS Alaska 191km Model" serviceName="myserver" &gt;
<br> &lt;dataset name="<strong>Forecast Model Run Datasets</strong>" <strong>ID=&quot;models/GFS/Alaska_191km/runs&quot;</strong>&gt;
   &lt;dataset name=&quot;GFS Alaska 191km Model <strong>run 2006-07-12 18:00</strong>&quot; urlPath=&quot;models/GFS/Alaska_191km/<strong>runs/GFS_Alaska_191km_20060712_1800.grib1</strong>&quot;&gt; 
   &lt;dataset name=&quot;GFS Alaska 191km Model <strong>run 2006-07-12 15:00</strong>&quot; urlPath=&quot;models/GFS/Alaska_191km/<strong>runs/GFS_Alaska_191km_20060712_1500.grib1</strong>&quot;&gt; 
   &lt;dataset name=&quot;GFS Alaska 191km Model <strong>run 2006-07-12 12:00</strong>&quot; urlPath=&quot;models/GFS/Alaska_191km/<strong>runs/GFS_Alaska_191km_20060712_1200.grib1</strong>&quot;&gt;
   ... 

 &lt;dataset&gt;
<br> &lt;dataset name="<strong>Constant Forecast Date Datasets</strong>" <strong>ID=&quot;models/GFS/Alaska_191km/forecast&quot;</strong>&gt;
   &lt;dataset name=&quot;GFS Alaska 191km Model<strong> constant forecast date 2006-07-12 18:00</strong>&quot;  urlPath=&quot;models/GFS/Alaska_191km/<strong>forecast/20060712_1800</strong>&quot;&gt; 
   &lt;dataset name=&quot;GFS Alaska 191km Model <strong>constant forecast date 2006-07-12 17:00</strong>&quot;  urlPath=&quot;models/GFS/Alaska_191km/<strong>forecast/20060712_1700</strong>&quot;&gt; 
   &lt;dataset name=&quot;GFS Alaska 191km Model <strong>constant forecast date 2006-07-12 16:00</strong>&quot;  urlPath=&quot;models/GFS/Alaska_191km/<strong>forecast/20060712_1600</strong>&quot;&gt;
   ... 

 &lt;dataset&gt;

 &lt;dataset name="<strong>Constant Forecast Offset Datasets</strong>" <strong>ID=&quot;models/GFS/Alaska_191km/offset&quot;</strong>&gt;
   &lt;dataset name=&quot;GFS Alaska 191km Model <strong>constant forecast offset 0 hours</strong>&quot;  urlPath=&quot;models/GFS/Alaska_191km/<strong>offset/0_hour</strong>&quot;&gt; 
   &lt;dataset name=&quot;GFS Alaska 191km Model <strong>constant forecast offset 3 hours</strong>&quot;  urlPath=&quot;models/GFS/Alaska_191km/<strong>offset/3_hour</strong>&quot;&gt; 
   &lt;dataset name=&quot;GFS Alaska 191km Model <strong>constant forecast offset 6 hours</strong>&quot;  urlPath=&quot;models/GFS/Alaska_191km/<strong>offset/6_hour</strong>&quot;&gt;
   ... 

 &lt;dataset&gt;<br><br> &lt;dataset name="<strong>Best Time Series Dataset</strong>" <strong>ID=&quot;models/GFS/Alaska_191km/best&quot;</strong> urlPath=&quot;models/GFS/Alaska_191km<strong>/best</strong>&quot; /&gt;
 <br>&lt;/dataset&gt;</pre>
<p>Doesnt have to be an aggregation, but it does have to be an NcML dataset: </p>
<pre>&lt;datasetFmrc path="models/ECMWF/cnmr" name="ECMWF cnmr Model" serviceName="myserver" &gt;
  <strong>&lt;netcdf xmlns="https://www.unidata.ucar.edu/namespaces/netcdf/ncml-2.2" location="C:/data/MM_cnrm_129_red.nc"&gt;</strong>
&lt;/datasetFmrc&gt;</pre>
<p>Has to be a dataset with two time axes, forecast and run time. We have to write an adapter that takes such a dataset and creates a
  ForecastModelRunCollection.</p>

<p>Because of the complication of missing data in the GRIB Collections, that should probably be a seperate implementation. </p>

<p>&nbsp;</p>
</body>
</html>
