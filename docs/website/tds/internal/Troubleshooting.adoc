:source-highlighter: coderay
[[threddsDocs]]

= Troubleshooting TDS

== Out of File handles

Solaris/Unix commands to monitor open file (and socket) handles:

-------------------------------------------
 1. ulimit -a      (show limits)
    ulimit -n nnnn (set open files to nnnn)
-------------------------------------------

----------------------------------------------------------------------------------
 2. /usr/proc/bin/pfiles [Tomcat Process ID] > pfiles.out

  98: S_IFREG mode:0644 dev:181,65538 ino:108165354 uid:10204 gid:6104 size:389012
      O_RDONLY|O_LARGEFILE
      /data/thredds/metars/Surface_METAR_20090223_0000.nc
----------------------------------------------------------------------------------

-----------------------------------------------------
 3. /usr/sbin/lsof -p [Tomcat Process ID] > lsof.out
-----------------------------------------------------

You will need to change to the tomcat user to have permission to run
*lsof*

Issue lsof to report the open files against a PID on a periodic basis.
For example:

-----------------------------------------------------------------
  lsof -p [Tomcat Process ID] -r (interval in seconds) > lsof.out
-----------------------------------------------------------------

regular files for some reasons dont show nicely: +

--------------------------------------------------------------------------------------------------------------------------------------
 java    10426 tomcat   86w  VREG   85,0     5104     240515 /opt/apache-tomcat-6.0.18-tds-dev/content/thredds/logs/threddsServlet.log
 java    10426 tomcat   94r                                  unknown file system type (zfs), v_op: 0xffffffff86cd7380
--------------------------------------------------------------------------------------------------------------------------------------

\4. if you need to increase the limit for number of open file
descriptors, run the following command:

--------------------------------------------------------------------
  ulimit -n nnnn (Where is nnnn is the desired number of open files)
--------------------------------------------------------------------

Its useful to clear the TDS cache:

---------------------------------------------------------------------------
  https://thredds.ucar.edu/thredds/admin/debug?Caches/clearCache
  https://thredds.ucar.edu/thredds/admin/debug?Caches/forceNCCache
  https://thredds.ucar.edu/thredds/admin/debug?Caches/forceRAFCache


Then look at

  /usr/proc/bin/pfiles [Tomcat Process ID]
---------------------------------------------------------------------------

to see what files are still open.

=== Windows

Use sysinternals process explorer

Â 

==  +
 Out of Memory

------
 <pid>
------

sudo /opt/jdk/bin/jmap -J-d64 -dump:format=b,file=dump.hprof -F

==  +
