<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>TDS Configuration with Properties</title>
<link rel="stylesheet" href="./../tds.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</head>
<body class="article">
<div id="header">
<h1>TDS Configuration with Properties</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_system_properties">System properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A number of TDS configuration settings can be set as Java system properties. Default values for some of these
properties are defined in the TDS properties file:
<code>${TOMCAT_HOME}/webapps/thredds/WEB-INF/classes/thredds/server/tds.properties</code>.</p>
</div>
<div class="paragraph">
<p>Modifying <code>tds.properties</code> is an alternative means of changing those configuration settings. However,
<code>tds.properties</code> lives in the <code>${TOMCAT_HOME}/webapps/</code> directory, meaning that it&#8217;ll be overwritten whenever the TDS
is upgraded. So, if you make any edits to that file, make sure to back them up before deploying a new version of
<code>thredds.war</code>, and then restore them after depoloyment.</p>
</div>
<div class="paragraph">
<p>The Java system properties that TDS uses for configuration are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 15%;">
<col style="width: 44%;">
<col style="width: 39%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value from <code>tds.properties</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.content.root.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root path for TDS content directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong>. The user <em>must</em> <a href="../UpgradingTo4.6.html">provide this value</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDS version number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${project.version}</code> (actual value substituted during build)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.version.builddate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDS build date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${build.timestamp}</code> (actual value substituted during build)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.install.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to the top level of the TDS installation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"catalog.html"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDS web page URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"https://www.unidata.ucar.edu/software/tds/v4.6/TDS.html"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.documentation.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDS documentation URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"https://www.unidata.ucar.edu/software/tds/v4.6/reference/index.html"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.logo.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDS logo URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"threddsIcon.gif"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.logo.alt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDS logo alternate text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"TDS"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.content.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full path for TDS content directory (relative to <code>tds.content.root.path</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"thredds"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.content.startup.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of default startup files. Used if <code>catalog.xml</code> or <code>threddsConfig.xml</code> are missing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"WEB-INF/altContent/startup"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tds.config.file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of TDS configuration file (relative to <code>tds.content.path</code>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"threddsConfig.xml"</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_content_root">Content Root</h3>
<div class="paragraph">
<p><code>tds.content.root.path</code> must be found before anything else is done. Typically, Tomcat is started from
<code>${TOMCAT_HOME}/bin</code>, and the content root is <code>${TOMCAT_HOME}/content</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_catalog_substitution">Catalog Substitution</h3>
<div class="paragraph">
<p>It&#8217;s possible to define property keys and use them in configuration catalogs. Values for those properties will be
substituted at runtime. In <code>${TOMCAT_HOME}/webapps/thredds/WEB-INF/applicationContext-tdsConfig.xml</code>, you&#8217;ll find:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;util:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataRootLocationAliasExpanders</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">map-class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cdmUnitTest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${unidata.testdata.path}/cdmUnitTest/</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we&#8217;ve defined a property called <code>cdmUnitTest</code> that will be assigned the value of
<code>${unidata.testdata.path}/cdmUnitTest/</code>
<span class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</span> at runtime. You can define more
by adding additional <code>entry</code> elements to the <code>util:map</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementation_details">Implementation Details</h3>
<div class="paragraph">
<p>The <code>dataRootLocationAliasExpanders</code> map will be injected into the <code>thredds.servlet.DataRootHandler</code> class by Spring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">dataRootLocationAliasExpanders</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> setDataRootLocationAliasExpanders(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; aliases) {
  dataRootLocationAliasExpanders = PathAliasReplacementImpl.makePathAliasReplacements(aliases);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a path in a catalog starts with a defined alias, the value will be substituted in the following places:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>when <code>DataRootHandler.addRoot()</code> is called</p>
</li>
<li>
<p>the <code>dataRootLocationAliasExpanders</code> are injected into <code>thredds.catalog.parser.jdom.InvCatalogFactory10</code>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>readFeatureCollection()</code>: spec string</p>
</li>
<li>
<p><code>readDatasetRoot()</code>: location / dirLocation</p>
</li>
<li>
<p><code>readDatasetScan()</code>: dirLocation</p>
</li>
<li>
<p><code>readDatasetScanNew()</code>: location</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note: the <code>thredds.featurecollection.FeatureCollectionConfig</code> objects themselves are not modified.
This is a problem with TDS.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. <code>unidata.testdata.path</code> is a system property we use internally for testing.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-06-16 19:48:13 MDT
</div>
</div>
</body>
</html>