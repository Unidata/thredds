:source-highlighter: coderay
[[threddsDocs]]

= TDS Configuration Catalogs

== Overview

TDS is configured using _configuration catalogs_ that live in the directory *$\{content_root}/thredds/* and its subdirectories.
These contain the same elements as <<../catalog/InvCatalogSpec#,client catalogs>>, as well as
<<../catalog/InvCatalogServerSpec#,information needed only on the server>>,
which is removed when the TDS sends the catalog to the requester.

=== Root Catalogs

The _root catalog_ is *$\{content_root}/thredds/catalog.xml*. It may reference other configuration catalogs using nested
*catalogRef* and *catalogScan* elements. The set of configuration catalogs is a tree with root *$\{content_root}/thredds/catalog.xml*.

The root catalog is also special in that any *services* declared in it are global, and are available for use in any other catalog.
Best practice is to declare all common services and <<../catalog/InvCatalogServerSpec.adoc#datasetRoot,datasetRoots>> in the root catalog.

One can create "hidden" catalogs by declaring
<<ThreddsConfigXMLFile.adoc#catalogRoots,extra catalog roots>> in **$\{content_root}/thredds/threddsConfig.xml**.
These are hidden in the sense that one cannot browse to them starting from the TDS root catalog.
The services and dataRoots declared in these are also global.

=== Catalog References (catalogRef)

All catalogs that you want to be seen and indexed (eg by crawlers) should be linked from the root catalog using _catalog reference_ elements.

A catalogRef element looks like:

[source,xml]
----
<catalogRef xlink:href="idd/models.xml" xlink:title="NCEP Model Data" name="" />
----

The *xlink:href* attribute names the referenced catalog; it must be relative to the catalog it is contained in. In this example, it would be in the
subdirectory *idd* under the directory of the catalog containing it . You can also use ".." to name peer directories:

[source,xml]
----
<catalogRef xlink:href="../idv/ncep.xml" xlink:title="IDV NCEP Model Data" name="" />
----

in this example, if the catalog is *$\{tomcat_home}/content/thredds/idd/models.xml,* then the referenced catalog is
*$\{tomcat_home}/content/thredds/idv/ncep.xml*

You can also use a relative URL that begins with "/" (a slash):

[source,xml]
----
<catalogRef xlink:href="/thredds/galeon/wcs/test.xml" xlink:title="GALEON Test Data" name="" />
----

which points to the catalog at *$\{content_root}/thredds/galeon/wcs/test.xml* no matter what catalog it appears in.
(These are simply the rules of reletive URLs.)
Note that the base directory is always *$\{content_root}/thredds/*, and all configuration catalogs must live under it.

=== DatasetScan Dynamic Catalogs

Dynamic catalogs are generated by <<DatasetScan#,DatasetScan>> elements, at the time the user request is made. These catalogs are not cached.
The request causes a single disk directory to be read. Files in the directory (that pass the filter) are made into _dataset_ elements. Any
subdirectories are made into _catalogRef_ elements, and are not read until a request is made for them.

=== Feature Collection Dynamic Catalogs

Dynamic catalogs are generated by <<collections/FeatureCollections#,FeatureCollection>> elements, at the time the user request is made.
Typically the top collection catalog is cached, but not subcollections. Each request typically causes a single collection index file to be read.

== Server Startup and Rereading Configuration Catalogs

When the TDS starts up, it needs to track what dataset URLs will be made available, which it discovers from the Configuration Catalogs.
It saves this information to a persistent store on disk, for faster startup.
By default, it will simply read all the configuration catalogs at startup and rewrite the store. If you have a very large number of catalogs, you may
want to reread only catalogs that have changed. If your catalogs rarely change, you might want to only reread only when you
explicitly trigger a reread.
See <<ThreddsConfigXMLFile.adoc#CatalogCaching,threddsConfig.xml>> for details on how to control this behavior.

The TDS no longer caches all catalogs, but internally keeps an LRU cache of recently requested catalogs, for performance.
You can control the number of cached catalogs in <<ThreddsConfigXMLFile.adoc#CatalogCaching,threddsConfig.xml>>.
Note that the _expires_ attribute is no longer used.

Assuming you are authorized with tdsConfig role, you can send commands to the TDS while it is running:

1. Reinitialize by rereading all configuration catalogs:

 https://server/thredds/admin/debug?Catalogs/reinit

2. Reread only configuration catalogs that have changed:

 https://server/thredds/admin/debug?Catalogs/recheck

3. Show statistics on all configuration catalogs (reads but does not reinit):

  https://server/thredds/admin/debug?Catalogs/reportStats

All are clickable from this page:

  https://server/thredds/admin/debug
